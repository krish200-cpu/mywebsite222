<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Search Results | Funeral Match</title>
    <style>
        :root { --primary: #0a1118; --gold: #c5a059; --bg: #f8fafc; --slate: #64748b; --green: #059669; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--primary); }

        header { background: white; padding: 15px 5%; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; }
        
        /* LOADING STATE */
        #gathering-overlay {
            position: fixed; inset: 0; background: white; z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }

        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
        .fd-card { background: white; border-radius: 16px; border: 1px solid #e2e8f0; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .t-pill { font-size: 0.65rem; font-weight: 800; padding: 4px 10px; border-radius: 50px; background: #dcfce7; color: #166534; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @media (max-width: 600px) { .fd-card { flex-direction: column; text-align: center; gap: 15px; } }
    </style>
</head>
<body>

<div id="gathering-overlay">
    <div class="spinner"></div>
    <h2 id="status">Gathering Information...</h2>
    <p id="pc-detail" style="color:var(--slate)"></p>
</div>

<header>
    <div style="font-weight:900;">FUNERAL MATCH</div>
    <div id="header-pc" style="font-size:0.8rem; font-weight:700; color:var(--slate)">üìç --</div>
</header>

<div class="container">
    <h2 style="margin-bottom:20px;">Closest 25 Directors</h2>
    <div id="feed"></div>
</div>

<script>
    // 1. GET DATA FROM URL
    const urlParams = new URLSearchParams(window.location.search);
    const postcode = urlParams.get('postcode');

    if (!postcode) {
        window.location.href = 'index.html'; // Kick back to start if no postcode
    } else {
        document.getElementById('pc-detail').innerText = `Locating directors near ${postcode.toUpperCase()}`;
        runScrape();
    }

    function runScrape() {
        // 2. SIMULATE GATHERING PROGRESS
        const statuses = ["Accessing local records...", "Calculating travel distances...", "Verifying Transparency...", "Finalizing results..."];
        let i = 0;
        const interval = setInterval(() => {
            document.getElementById('status').innerText = statuses[i];
            i++;
            if (i >= statuses.length) {
                clearInterval(interval);
                displayResults();
            }
        }, 600);
    }

    function displayResults() {
        document.getElementById('gathering-overlay').style.display = 'none';
        document.getElementById('header-pc').innerText = "üìç " + postcode.toUpperCase();
        
        const names = ["D J Cotton & Sons", "L E Brand & Sons", "F.E.J. Green", "T. Cribb & Sons", "Co-op Funeralcare", "Dignity", "West & Coe", "Abbey Funeral"];
        const feed = document.getElementById('feed');
        
        let html = "";
        for(let j=1; j<=25; j++) {
            const name = names[j % names.length] + (j > 8 ? ` (Branch ${j})` : "");
            const dist = (j * 0.4).toFixed(1);
            const price = 1100 + (Math.random() * 1000);
            html += `
                <div class="fd-card">
                    <div>
                        <span class="t-pill">99% Transparency</span>
                        <h3 style="margin:5px 0 0 0">${name}</h3>
                        <p style="color:var(--slate); font-size:0.8rem; margin:5px 0;">${dist} miles away</p>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:1.5rem; font-weight:900;">¬£${Math.floor(price).toLocaleString()}</div>
                        <button style="background:var(--primary); color:white; border:none; padding:8px 15px; border-radius:6px; font-weight:700; cursor:pointer">View details</button>
                    </div>
                </div>
            `;
        }
        feed.innerHTML = html;
    }
</script>
</body>
</html>
