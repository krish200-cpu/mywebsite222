<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FuneralMatch | Tele-Arranger Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --sidebar: #111827; --panel: #1F2937; --gold: #D4AF37; --border: #E5E7EB; }
        body { font-family: 'Inter', sans-serif; background: #F3F4F6; height: 100vh; overflow: hidden; }
        
        /* Dense Layout Overrides */
        .input-dense { 
            width: 100%; font-size: 13px; padding: 6px 10px; border: 1px solid #D1D5DB; 
            border-radius: 4px; transition: 0.1s; background: white;
        }
        .input-dense:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 0 1px var(--gold); }
        .label-dense { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #6B7280; margin-bottom: 2px; display: block; }
        
        /* Section Headers */
        .sec-head { background: #F9FAFB; padding: 8px 12px; border-bottom: 1px solid #E5E7EB; border-top: 1px solid #E5E7EB; font-weight: 700; font-size: 12px; color: #374151; display: flex; justify-content: space-between; align-items: center; }
        
        /* Scroll Areas */
        .scroll-area { overflow-y: auto; height: 100%; scrollbar-width: thin; }
        .scroll-area::-webkit-scrollbar { width: 6px; }
        .scroll-area::-webkit-scrollbar-thumb { background: #CBD5E1; }

        /* The Audit Log (Matrix Style) */
        .audit-log { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #10B981; background: #111827; padding: 10px; height: 150px; overflow-y: auto; border-radius: 4px; margin-top: 10px; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #1F2937; padding-bottom: 2px; }

        /* Alerts */
        .risk-badge { background: #FEE2E2; color: #991B1B; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 800; border: 1px solid #FCA5A5; display: none; }
        .risk-badge.active { display: inline-block; }
    </style>
</head>
<body class="flex">

    <aside class="w-16 bg-[#111827] flex flex-col items-center py-4 z-20 shrink-0">
        <div class="w-8 h-8 bg-[#D4AF37] text-black font-bold flex items-center justify-center rounded mb-8">FM</div>
        
        <nav class="space-y-6 w-full">
            <button onclick="scrollToId('sec-caller')" class="nav-btn w-full text-gray-400 hover:text-white flex flex-col items-center gap-1">
                <i class="fas fa-phone-alt"></i><span class="text-[8px] uppercase">Call</span>
            </button>
            <button onclick="scrollToId('sec-deceased')" class="nav-btn w-full text-gray-400 hover:text-white flex flex-col items-center gap-1">
                <i class="fas fa-user"></i><span class="text-[8px] uppercase">Body</span>
            </button>
            <button onclick="scrollToId('sec-logistics')" class="nav-btn w-full text-gray-400 hover:text-white flex flex-col items-center gap-1">
                <i class="fas fa-truck"></i><span class="text-[8px] uppercase">Logs</span>
            </button>
            <button onclick="scrollToId('sec-finance')" class="nav-btn w-full text-gray-400 hover:text-white flex flex-col items-center gap-1">
                <i class="fas fa-pound-sign"></i><span class="text-[8px] uppercase">$</span>
            </button>
        </nav>
    </aside>

    <main class="flex-1 bg-white border-r border-gray-200 flex flex-col h-screen">
        
        <header class="h-12 border-b flex items-center justify-between px-4 bg-gray-50 shrink-0">
            <div class="flex items-center gap-3">
                <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded border border-red-200 animate-pulse">LIVE CALL</span>
                <span class="text-sm font-bold text-gray-700">Arrangement #TR-2026-889</span>
            </div>
            <div class="text-xs text-gray-500" id="clock">00:00:00</div>
        </header>

        <div class="scroll-area p-6" id="master-form">
            
            <div id="sec-caller" class="mb-8">
                <div class="sec-head mb-4"><i class="fas fa-phone mr-2"></i> INTAKE / CALLER</div>
                <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-6">
                        <label class="label-dense">Caller Name</label>
                        <input type="text" class="input-dense bg-yellow-50" placeholder="Who are you speaking to?" oninput="Log('Caller identified as ' + this.value)">
                    </div>
                    <div class="col-span-3">
                        <label class="label-dense">Relation</label>
                        <select class="input-dense"><option>Son/Daughter</option><option>Spouse</option><option>Executor</option></select>
                    </div>
                    <div class="col-span-3">
                        <label class="label-dense">Phone</label>
                        <input type="text" class="input-dense">
                    </div>
                    <div class="col-span-12 bg-blue-50 p-2 text-[10px] text-blue-800 border border-blue-100 rounded mt-1">
                        <strong>SCRIPT:</strong> "I am so sorry for your loss. My name is [Name], and I will personally handle everything. Is now a good time to gather some details?"
                    </div>
                </div>
            </div>

            <div id="sec-deceased" class="mb-8">
                <div class="sec-head mb-4"><i class="fas fa-user-clock mr-2"></i> DECEASED BIOMETRICS</div>
                <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-2">
                        <label class="label-dense">Title</label>
                        <select class="input-dense"><option>Mr</option><option>Mrs</option><option>Ms</option><option>Dr</option></select>
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">First Name</label>
                        <input type="text" class="input-dense" oninput="updateDeceased(this.value)">
                    </div>
                    <div class="col-span-6">
                        <label class="label-dense">Surname</label>
                        <input type="text" class="input-dense">
                    </div>
                    
                    <div class="col-span-4">
                        <label class="label-dense">Date of Birth</label>
                        <input type="date" id="inp-dob" class="input-dense" onchange="Bot.calcAge()">
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">Date of Death</label>
                        <input type="date" id="inp-dod" class="input-dense" onchange="Bot.calcAge()">
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">Calc. Age</label>
                        <input type="text" id="out-age" class="input-dense bg-gray-100 font-bold text-black" readonly>
                    </div>

                    <div class="col-span-12 flex gap-4 mt-2 border-t pt-2">
                        <label class="flex items-center gap-2 text-xs font-bold">
                            <input type="checkbox" onchange="Bot.toggleCoroner(this.checked)"> 
                            Coroner Case?
                        </label>
                        <div id="coroner-fields" class="hidden flex gap-2 flex-1">
                            <input type="text" class="input-dense" placeholder="Coroner Officer Name">
                            <input type="text" class="input-dense" placeholder="Ref Number">
                        </div>
                    </div>
                </div>
            </div>

            <div id="sec-logistics" class="mb-8">
                <div class="sec-head mb-4"><i class="fas fa-ambulance mr-2"></i> FIRST CALL REMOVAL</div>
                <div class="grid grid-cols-12 gap-3 bg-gray-50 p-3 rounded border border-gray-200">
                    <div class="col-span-8">
                        <label class="label-dense">Collection Address</label>
                        <input type="text" class="input-dense" placeholder="Hospital / Care Home / Private Res">
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">Postcode (Mileage Bot)</label>
                        <input type="text" class="input-dense" onblur="Bot.calcMileage()">
                    </div>
                    
                    <div class="col-span-4">
                        <label class="label-dense">Preferred Date</label>
                        <input type="date" class="input-dense">
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">Time</label>
                        <input type="time" class="input-dense" onchange="Bot.checkOOH(this.value)">
                    </div>
                    <div class="col-span-4">
                        <label class="label-dense">Staff Required</label>
                        <select class="input-dense" id="staff-req" onchange="Pricing.calc()">
                            <option value="2">2 Bearers (Std)</option>
                            <option value="4">4 Bearers (Complex)</option>
                        </select>
                    </div>
                    
                    <div class="col-span-12" id="alert-zone-logistics"></div>
                </div>
            </div>

            <div id="sec-ops" class="mb-8">
                <div class="sec-head mb-4"><i class="fas fa-box mr-2"></i> WORKSHOP OPS</div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="label-dense">Casket Selection</label>
                        <select class="input-dense h-10 font-bold" id="sel-coffin" onchange="Pricing.calc(); Log('Coffin changed to ' + this.value)">
                            <option value="0">Simple (Included)</option>
                            <option value="450">Willow Weave (+£450)</option>
                            <option value="800">Oak Veneer (+£800)</option>
                            <option value="1200">Solid Oak (+£1200)</option>
                        </select>
                    </div>
                    <div class="bg-red-50 border border-red-200 p-2 rounded">
                        <label class="label-dense text-red-800">Clinical Risks</label>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-xs font-bold">Pacemaker Present?</span>
                            <input type="checkbox" id="chk-pace" class="w-5 h-5 accent-red-600" onchange="Bot.togglePacemaker(this.checked)">
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <label class="label-dense">Internal Notes (Not visible to client)</label>
                <textarea class="input-dense h-24 bg-yellow-50 font-mono" placeholder="Family mentioned dispute over will..."></textarea>
            </div>

        </div>
    </main>

    <aside class="w-80 bg-white border-l border-gray-200 flex flex-col z-10 shadow-xl shrink-0">
        
        <div class="p-6 bg-[#1F2937] text-white">
            <div class="text-[10px] uppercase font-bold text-gray-400">Total Estimated Cost</div>
            <div class="text-3xl font-bold font-mono text-[#D4AF37] mt-1" id="display-total">£0.00</div>
            
            <div class="mt-4 space-y-1 text-xs text-gray-300 border-t border-gray-700 pt-2">
                <div class="flex justify-between"><span>Professional Fees</span><span>£1,200</span></div>
                <div class="flex justify-between"><span>Coffin</span><span id="cost-coffin">£0</span></div>
                <div class="flex justify-between"><span>Logistics</span><span id="cost-logs">£0</span></div>
                <div class="flex justify-between text-red-400 hidden" id="row-pace"><span>Pacemaker Removal</span><span>£90</span></div>
                <div class="flex justify-between text-red-400 hidden" id="row-ooh"><span>Out of Hours</span><span>£150</span></div>
            </div>
        </div>

        <div class="p-4 border-b border-gray-200 bg-gray-50 flex-1">
            <div class="text-[10px] uppercase font-bold text-gray-500 mb-2">Active Risks</div>
            <div id="risk-container" class="space-y-2">
                <div class="text-xs text-gray-400 italic" id="no-risks">No risks identified yet.</div>
                <span id="badge-pace" class="risk-badge">PACEMAKER</span>
                <span id="badge-coroner" class="risk-badge bg-blue-100 text-blue-800 border-blue-200">CORONER</span>
                <span id="badge-ooh" class="risk-badge bg-orange-100 text-orange-800 border-orange-200">OUT OF HOURS</span>
                <span id="badge-weight" class="risk-badge bg-purple-100 text-purple-800 border-purple-200">HEAVY LIFT</span>
            </div>
        </div>

        <div class="p-4 bg-black">
            <div class="text-[10px] uppercase font-bold text-gray-500 mb-1">System Audit</div>
            <div class="audit-log" id="audit-feed">
                <div class="log-entry">> System Initialized</div>
                <div class="log-entry">> Rate Card Loaded</div>
            </div>
        </div>

        <div class="p-4 grid grid-cols-2 gap-2 bg-gray-100 border-t">
            <button class="bg-white border border-gray-300 text-gray-700 font-bold text-xs py-3 rounded hover:bg-gray-50">Save Draft</button>
            <button class="bg-[#D4AF37] text-black font-bold text-xs py-3 rounded shadow hover:bg-[#b08d4b]" onclick="alert('Sent to Email Queue')">Generate Contract</button>
        </div>

    </aside>

    <script>
        // --- 1. THE BRAIN (Logic Bots) ---
        const Bot = {
            calcAge: () => {
                const dob = new Date(document.getElementById('inp-dob').value);
                const dod = new Date(document.getElementById('inp-dod').value);
                if(dob && dod) {
                    const diff = dod - dob;
                    const age = Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
                    document.getElementById('out-age').value = age + " Years";
                    Log(`Age calculated: ${age}`);
                }
            },
            toggleCoroner: (checked) => {
                const fields = document.getElementById('coroner-fields');
                const badge = document.getElementById('badge-coroner');
                if(checked) {
                    fields.classList.remove('hidden');
                    badge.classList.add('active');
                    Log('Flagged as Coroner Case');
                } else {
                    fields.classList.add('hidden');
                    badge.classList.remove('active');
                    Log('Coroner flag removed');
                }
                checkRisks();
            },
            togglePacemaker: (checked) => {
                const row = document.getElementById('row-pace');
                const badge = document.getElementById('badge-pace');
                if(checked) {
                    row.classList.remove('hidden');
                    badge.classList.add('active');
                    Log('CRITICAL: Pacemaker added');
                } else {
                    row.classList.add('hidden');
                    badge.classList.remove('active');
                }
                Pricing.calc();
                checkRisks();
            },
            checkOOH: (timeStr) => {
                if(!timeStr) return;
                const hour = parseInt(timeStr.split(':')[0]);
                const isOOH = (hour < 8 || hour >= 17);
                const badge = document.getElementById('badge-ooh');
                const row = document.getElementById('row-ooh');
                
                if(isOOH) {
                    badge.classList.add('active');
                    row.classList.remove('hidden');
                    Log('Time set to Out of Hours');
                } else {
                    badge.classList.remove('active');
                    row.classList.add('hidden');
                }
                Pricing.calc();
                checkRisks();
            },
            calcMileage: () => {
                // Mock calculation
                Log('Calculating mileage from HQ...');
                setTimeout(() => Log('Distance: 12 miles (Zone A)'), 500);
            }
        };

        // --- 2. PRICING ENGINE ---
        const Pricing = {
            base: 1200,
            calc: () => {
                let total = Pricing.base;
                
                // Coffin
                const coffinPrice = parseInt(document.getElementById('sel-coffin').value);
                document.getElementById('cost-coffin').innerText = `£${coffinPrice}`;
                total += coffinPrice;

                // Pacemaker
                if(document.getElementById('chk-pace').checked) total += 90;

                // OOH
                const timeStr = document.querySelector('input[type="time"]').value;
                if(timeStr) {
                    const h = parseInt(timeStr.split(':')[0]);
                    if(h < 8 || h >= 17) total += 150;
                }

                // Bearers
                const staff = document.getElementById('staff-req').value;
                let logCost = 0;
                if(staff === "4") { logCost += 200; Log('Complex Lift: 4 Bearers added'); }
                document.getElementById('cost-logs').innerText = `£${logCost}`;
                total += logCost;

                // Render
                document.getElementById('display-total').innerText = new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(total);
            }
        };

        // --- 3. UTILITIES ---
        function Log(msg) {
            const feed = document.getElementById('audit-feed');
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            feed.innerHTML += `<div class="log-entry text-gray-300">> [${time}] <span class="text-white">${msg}</span></div>`;
            feed.scrollTop = feed.scrollHeight;
        }

        function checkRisks() {
            const badges = document.querySelectorAll('.risk-badge.active');
            const empty = document.getElementById('no-risks');
            if(badges.length > 0) empty.style.display = 'none';
            else empty.style.display = 'block';
        }

        function scrollToId(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function updateDeceased(name) {
            // Update Tab Title or generic header if needed
        }

        // Clock
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // Init
        Pricing.calc();

    </script>
</body>
</html>
