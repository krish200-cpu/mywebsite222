<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arrangement Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --deep-slate: #121416; --card-bg: #1C1F22; --gold: #B39359; --white: #F4F4F4; --text-dim: #8A8F98; --border: rgba(255, 255, 255, 0.08); --red: #E63946; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        body { background: var(--deep-slate); color: var(--white); -webkit-font-smoothing: antialiased; }
        
        .emergency-bar { background: rgba(230, 57, 70, 0.1); border-bottom: 1px solid var(--red); padding: 12px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1001; backdrop-filter: blur(10px); }
        .emergency-btn { background: var(--red); color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: 700; font-size: 0.75rem; text-decoration: none; }
        
        .header { padding: 20px; text-align: center; border-bottom: 1px solid var(--border); background: var(--deep-slate); }
        .progress-track { width: 100%; height: 4px; background: var(--border); margin: 10px 0; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gold); transition: 0.5s ease; width: 10%; }
        
        .container { max-width: 600px; margin: 0 auto; padding: 40px 20px 150px; }
        h1 { font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 8px; text-align: center; }
        .desc { color: var(--text-dim); text-align: center; margin-bottom: 30px; font-size: 0.85rem; }

        .card { background: var(--card-bg); border: 1px solid var(--border); padding: 20px; border-radius: 16px; cursor: pointer; display: flex; align-items: center; gap: 15px; margin-bottom: 12px; }
        .card.active { border-color: var(--gold); background: rgba(179, 147, 89, 0.08); }
        .price { margin-left: auto; color: var(--gold); font-weight: 600; }
        
        .input-box { width: 100%; background: #000; border: 1px dashed var(--gold); padding: 15px; border-radius: 12px; color: white; margin-top: 10px; }
        .qty-ctrl { display: flex; align-items: center; gap: 20px; margin-top: 10px; }
        .q-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--gold); background: transparent; color: var(--gold); font-size: 1.2rem; cursor: pointer; }

        .footer { position: fixed; bottom: 0; width: 100%; background: rgba(18,20,22,0.95); padding: 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .total-box { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: var(--gold); }
        .next-btn { background: var(--gold); color: #000; padding: 15px 30px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="emergency-bar">
    <div style="color: var(--red); font-size: 0.75rem; font-weight: 600;">FIRST CALL EMERGENCY</div>
    <a href="tel:0800000000" class="emergency-btn">CONNECT NOW</a>
</div>

<div class="header">
    <div id="stepInfo" style="font-size: 0.6rem; color: var(--gold); letter-spacing: 2px;">STEP 1 OF 10</div>
    <div class="progress-track"><div class="progress-fill" id="prog"></div></div>
</div>

<div class="container" id="stage"></div>

<div class="footer">
    <div class="total-box" id="liveTotal">£0</div>
    <button class="next-btn" onclick="next()">Continue</button>
</div>

<script>
    let cur = 1, base = 2500, choices = {};
    const steps = {
        1: { t: "Method", d: "Choose committal type.", opts: [{ n: "Cremation", p: 0, s: 'c' }, { n: "Traditional Burial", p: 1500, s: 'b' }, { n: "Burial at Sea", p: 3200, s: 's' }] },
        2: { t: "Attendance", d: "Note: Burials must be attended.", opts: [{ n: "Direct (Unattended)", p: 0, s: 'd' }, { n: "Attended Service", p: 600, s: 'a' }] },
        3: { t: "Coffins", d: "Select a vessel.", opts: [{ n: "Oak Veneer", p: 0 }, { n: "Willow", p: 550 }, { n: "Solid Mahogany", p: 1200 }, { n: "Sea Specialist", p: 1450 }] },
        4: { t: "Vehicles", d: "Choose standard or bespoke (Ferrari, Bus, etc).", type: "veh" },
        5: { t: "Care", d: "Combined choices allowed.", type: "multi", opts: [{ n: "Embalming", p: 250 }, { n: "Viewing", p: 150 }, { n: "Dressing", p: 50 }] },
        6: { t: "Service", d: "Build your sequence.", type: "multi", opts: [{ n: "Church Service", p: 350 }, { n: "Home Procession", p: 150 }, { n: "Celebrant", p: 250 }] },
        7: { t: "Stationery", d: "20 copies start at £80.", type: "stat" },
        8: { t: "Flowers", d: "Package deals.", opts: [{ n: "None", p: 0 }, { n: "Small", p: 120 }, { n: "Medium", p: 280 }, { n: "Large", p: 450 }] },
        9: { t: "Admin", d: "Mandatory fees.", type: "adm" },
        10: { t: "Memorials", d: "Final tributes.", type: "multi", opts: [{ n: "Grave Stone", p: 1200 }, { n: "Bench", p: 600 }, { n: "Jewelry", p: 250 }] }
    };

    function render() {
        const s = steps[cur];
        const meth = choices[1]?.s;
        if(cur===2 && (meth==='b' || meth==='s')) { choices[2] = {n:"Attended", p:600, s:'a'}; cur=3; render(); return; }
        
        document.getElementById('stepInfo').innerText = `STEP ${cur} OF 10`;
        document.getElementById('prog').style.width = (cur*10) + '%';
        let h = `<h1>${s.t}</h1><p class="desc">${s.d}</p>`;

        if(cur===4 && choices[2]?.s==='d') { h += `<div class="card active">Private Ambulance<div class="price">Incl.</div></div>`; choices[4]={n:"Private Ambulance", p:0, l:0}; }
        else if(s.type === 'veh') {
            const l = choices[4]?.l || 0;
            h += `<div class="card ${choices[4]?.n==='Standard'?'active':''}" onclick="setV('Standard',0)">Standard Hearse<div class="price">Incl.</div></div>
                  <div class="card ${choices[4]?.b?'active':''}" onclick="setV('Bespoke',0,true)">Bespoke (Ferrari/Bus/etc)<div class="price">POA</div></div>
                  ${choices[4]?.b? `<input class="input-box" placeholder="Vehicle type..." oninput="choices[4].req=this.value" value="${choices[4].req||''}">` : ''}
                  <div class="card active" style="display:block">Limousines (+£250 ea)<div class="qty-ctrl"><button class="q-btn" onclick="updL(-1)">-</button><span>${l}</span><button class="q-btn" onclick="updL(1)">+</button></div></div>`;
        } else if(s.type === 'multi') {
            if(!choices[cur]) choices[cur] = [];
            h += s.opts.map(o => `<div class="card ${choices[cur].some(x=>x.n===o.n)?'active':''}" onclick="tglM('${o.n}',${o.p})">${o.n}<div class="price">+£${o.p}</div></div>`).join('');
        } else if(s.type === 'stat') {
            const q = choices[7]?.q || 20;
            h += `<div class="card active" style="flex-direction:column"><h2>${q} Copies</h2><div class="qty-ctrl"><button class="q-btn" onclick="updS(-10)">-</button><button class="q-btn" onclick="updS(10)">+</button></div></div>`;
        } else if(s.type === 'adm') {
            h += `<div class="card active">Professional Fee<div class="price">£1,200</div></div><div class="card active">Doctor Fees<div class="price">£164</div></div><div class="card active">Legal Admin<div class="price">£150</div></div>`;
            choices[9] = {p:1514, n:"Admin & Legal"};
        } else {
            h += s.opts.map(o => `<div class="card ${choices[cur]?.n===o.n?'active':''}" onclick="setS('${o.n}',${o.p},'${o.s||''}')">${o.n}<div class="price">${o.p>0?'+£'+o.p:'Incl.'}</div></div>`).join('');
        }
        document.getElementById('stage').innerHTML = h;
        calc();
    }

    function setS(n,p,s) { choices[cur] = {n,p,s}; render(); }
    function tglM(n,p) { let a = choices[cur]; const i = a.findIndex(x=>x.n===n); if(i>-1) a.splice(i,1); else a.push({n,p}); render(); }
    function setV(n,p,b=false) { choices[4] = {n,p,b,l:choices[4]?.l||0}; render(); }
    function updL(v) { if(!choices[4]) setV('Standard',0); choices[4].l = Math.max(0, choices[4].l+v); render(); }
    function updS(v) { const q = Math.min(250, Math.max(20, (choices[7]?.q||20)+v)); choices[7] = {n:q+' Copies', q, p:80+((q-20)/10*15)}; render(); }
    
    function calc() {
        let x = 0;
        Object.keys(choices).forEach(k => {
            if(Array.isArray(choices[k])) choices[k].forEach(v=>x+=v.p);
            else { x+=choices[k].p||0; if(k==='4') x+=(choices[k].l*250); }
        });
        document.getElementById('liveTotal').innerText = '£'+(base+x).toLocaleString();
    }

    function next() {
        if(cur < 10) { cur++; render(); window.scrollTo(0,0); }
        else { localStorage.setItem('f_data', JSON.stringify({base, choices})); window.location.href='review.html'; }
    }
    render();
</script>
</body>
</html>
