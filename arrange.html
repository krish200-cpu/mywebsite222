<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FuneralMatch | Logic Flow</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Manrope:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { onyx: '#1A1A1A', gold: '#C5A059', cream: '#F9F8F6', concrete: '#F3F4F6' },
                    fontFamily: { serif: ['Playfair Display', 'serif'], sans: ['Manrope', 'sans-serif'] },
                    borderRadius: { 'pill': '9999px' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F3F4F6; color: #1A1A1A; }
        
        /* THE PILL INPUT SYSTEM */
        .input-pill {
            width: 100%; background: white; border: 1px solid #E5E7EB; border-radius: 9999px;
            padding: 14px 24px; font-family: 'Manrope', sans-serif; font-size: 14px;
            outline: none; transition: all 0.2s;
        }
        .input-pill:focus { border-color: #C5A059; box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.1); }
        .input-pill::placeholder { color: #9CA3AF; }

        .label-pill {
            margin-left: 20px; margin-bottom: 6px; display: block;
            font-size: 11px; font-weight: 700; text-transform: uppercase; color: #6B7280; letter-spacing: 0.05em;
        }

        /* Toggle Switch (Pill Style) */
        .toggle-pill { appearance: none; width: 44px; height: 24px; background: #E5E7EB; border-radius: 999px; position: relative; cursor: pointer; transition: 0.3s; }
        .toggle-pill:checked { background: #C5A059; }
        .toggle-pill::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle-pill:checked::after { transform: translateX(20px); }

        /* Animations */
        .slide-enter-active, .slide-leave-active { transition: all 0.4s ease; }
        .slide-enter-from { opacity: 0; transform: translateX(20px); }
        .slide-leave-to { opacity: 0; transform: translateX(-20px); }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

<div id="app" class="h-full flex flex-col">

    <header class="h-20 bg-onyx text-white flex items-center justify-between px-6 shrink-0 z-50">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-full bg-gold flex items-center justify-center font-serif font-bold text-onyx text-xl">F</div>
            <div class="hidden md:block">
                <div class="text-[10px] text-gold uppercase tracking-widest font-bold">New Arrangement</div>
                <div class="font-serif text-lg">Logic Flow</div>
            </div>
        </div>

        <div class="flex gap-2">
            <div v-for="(step, index) in steps" :key="index" 
                 class="h-2 rounded-full transition-all duration-500"
                 :class="currentStep >= index ? 'bg-gold w-8' : 'bg-gray-700 w-2'"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto bg-gray-50 p-4 md:p-10 flex flex-col items-center">
        
        <transition name="slide" mode="out-in">
            
            <div v-if="currentStep === 0" class="w-full max-w-2xl" key="step1">
                <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">Who are we caring for?</h1>
                    <p class="text-gray-500">Legal identity required for Registrar.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-sm space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                        <div class="md:col-span-3">
                            <label class="label-pill">Title</label>
                            <select v-model="form.deceased.title" class="input-pill appearance-none">
                                <option>Mr</option><option>Mrs</option><option>Ms</option><option>Dr</option>
                            </select>
                        </div>
                        <div class="md:col-span-9">
                            <label class="label-pill">Full Legal Name</label>
                            <input v-model="form.deceased.firstName" class="input-pill" placeholder="First & Middle Names">
                        </div>
                    </div>
                    
                    <div>
                        <label class="label-pill">Surname</label>
                        <input v-model="form.deceased.lastName" class="input-pill" placeholder="Surname">
                    </div>

                    <div>
                        <label class="label-pill">Maiden Name / Aliases</label>
                        <input v-model="form.deceased.alias" class="input-pill" placeholder="If applicable (Required for Death Cert)">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="label-pill">Marital Status</label>
                            <select v-model="form.deceased.marital" class="input-pill">
                                <option>Married / Civil Partner</option>
                                <option>Widowed</option>
                                <option>Divorced</option>
                                <option>Single</option>
                            </select>
                        </div>
                        <div>
                            <label class="label-pill">Occupation (Prior to retirement)</label>
                            <input v-model="form.deceased.occupation" class="input-pill" placeholder="e.g. Engineer">
                        </div>
                    </div>
                </div>
            </div>

            <div v-else-if="currentStep === 1" class="w-full max-w-2xl" key="step2">
                <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">When & Where?</h1>
                    <p class="text-gray-500">Establishing timeline and jurisdiction.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-sm space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="label-pill">Date of Birth</label>
                            <input type="date" v-model="form.deceased.dob" class="input-pill">
                        </div>
                        <div>
                            <label class="label-pill">Date of Death</label>
                            <input type="date" v-model="form.deceased.dod" class="input-pill">
                        </div>
                    </div>

                    <div>
                        <label class="label-pill">Place of Death</label>
                        <select v-model="form.deceased.deathPlaceType" class="input-pill mb-3">
                            <option>Hospital (NHS)</option>
                            <option>Nursing / Care Home</option>
                            <option>Private Residence</option>
                            <option>Public Place / Coroner</option>
                        </select>
                        <input v-model="form.deceased.deathAddress" class="input-pill" placeholder="Full Address / Ward Name">
                    </div>

                    <div class="bg-blue-50 p-6 rounded-[20px] border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-serif text-lg text-blue-900">Coroner Involvement?</h3>
                                <p class="text-xs text-blue-600">If death was sudden or cause unknown.</p>
                            </div>
                            <input type="checkbox" v-model="form.legal.coroner" class="toggle-pill">
                        </div>
                        <div v-if="form.legal.coroner" class="mt-4 animate-fade">
                            <label class="label-pill text-blue-800">Coroner's Officer Name</label>
                            <input v-model="form.legal.coronerOfficer" class="input-pill border-blue-200" placeholder="Officer Name & Ref">
                        </div>
                    </div>
                </div>
            </div>

            <div v-else-if="currentStep === 2" class="w-full max-w-2xl" key="step3">
                <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">Care & Disposition</h1>
                    <p class="text-gray-500">Preparation and final resting details.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-sm space-y-8">
                    
                    <div class="flex bg-gray-100 p-1 rounded-full">
                        <button @click="form.disposition.type = 'cremation'" class="flex-1 py-3 rounded-full text-sm font-bold transition-all" :class="form.disposition.type === 'cremation' ? 'bg-onyx text-white shadow-lg' : 'text-gray-500 hover:text-onyx'">Cremation</button>
                        <button @click="form.disposition.type = 'burial'" class="flex-1 py-3 rounded-full text-sm font-bold transition-all" :class="form.disposition.type === 'burial' ? 'bg-onyx text-white shadow-lg' : 'text-gray-500 hover:text-onyx'">Burial</button>
                    </div>

                    <div>
                        <h3 class="font-serif text-lg mb-4">Clinical Safety Checks</h3>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between p-4 border rounded-[20px] cursor-pointer hover:bg-gray-50 transition" :class="{'border-red-500 bg-red-50': form.clinical.pacemaker}">
                                <span class="font-bold text-sm">Pacemaker Fitted?</span>
                                <input type="checkbox" v-model="form.clinical.pacemaker" class="toggle-pill">
                            </label>
                            <label class="flex items-center justify-between p-4 border rounded-[20px] cursor-pointer hover:bg-gray-50 transition">
                                <span class="font-bold text-sm">Embalming Permission?</span>
                                <input type="checkbox" v-model="form.clinical.embalming" class="toggle-pill">
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="label-pill">Chapel of Rest Viewing</label>
                        <select v-model="form.ceremony.viewing" class="input-pill">
                            <option>No Viewing</option>
                            <option>Family Only (Closed Casket)</option>
                            <option>Open Viewing (By Appointment)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div v-else-if="currentStep === 3" class="w-full max-w-2xl" key="step4">
                <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">The Service</h1>
                    <p class="text-gray-500">Logistics of the ceremony.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-sm space-y-6">
                    
                    <div>
                        <label class="label-pill">Service Venue</label>
                        <input v-model="form.ceremony.venue" class="input-pill" placeholder="e.g. West Chapel Crematorium">
                    </div>

                    <div class="bg-gray-50 p-6 rounded-[24px]">
                        <div class="flex justify-between items-center mb-4">
                            <label class="label-pill mb-0">Date & Time</label>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold text-gray-400">MARK AS TBC</span>
                                <input type="checkbox" v-model="form.ceremony.dateTbc" class="toggle-pill scale-75">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4" :class="{'opacity-40 pointer-events-none': form.ceremony.dateTbc}">
                            <input type="date" v-model="form.ceremony.date" class="input-pill">
                            <input type="time" v-model="form.ceremony.time" class="input-pill">
                        </div>
                    </div>

                    <div>
                        <label class="label-pill">Officiant / Minister</label>
                        <input v-model="form.ceremony.officiant" class="input-pill" placeholder="Name or 'Allocated by Church'">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="label-pill">Music: Entry</label>
                            <input v-model="form.ceremony.musicEntry" class="input-pill" placeholder="Artist - Song">
                        </div>
                        <div>
                            <label class="label-pill">Music: Exit</label>
                            <input v-model="form.ceremony.musicExit" class="input-pill" placeholder="Artist - Song">
                        </div>
                    </div>
                </div>
            </div>

            <div v-else-if="currentStep === 4" class="w-full max-w-2xl" key="step5">
                <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">Vehicles & Merchandise</h1>
                    <p class="text-gray-500">Finalizing resources.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-sm space-y-8">
                    
                    <div>
                        <label class="label-pill">Casket Selection</label>
                        <select v-model="form.resources.coffin" class="input-pill">
                            <option value="Morpeth Oak">Morpeth Oak (Std)</option>
                            <option value="Willow">Natural Willow (+£650)</option>
                            <option value="Solid">Solid Wood (+£1200)</option>
                            <option value="Cardboard">Eco Cardboard (+£200)</option>
                        </select>
                    </div>

                    <div class="bg-gray-900 text-white p-6 rounded-[24px]">
                        <h3 class="font-serif text-lg mb-4">Fleet Requirements</h3>
                        
                        <div class="flex items-center justify-between mb-4">
                            <span>Hearse Type</span>
                            <div class="flex bg-gray-800 rounded-full p-1">
                                <button @click="form.resources.hearse = 'motor'" class="px-4 py-1 rounded-full text-xs font-bold" :class="form.resources.hearse === 'motor' ? 'bg-gold text-onyx' : 'text-gray-400'">Motor</button>
                                <button @click="form.resources.hearse = 'horse'" class="px-4 py-1 rounded-full text-xs font-bold" :class="form.resources.hearse === 'horse' ? 'bg-gold text-onyx' : 'text-gray-400'">Horse</button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span>Limousines (7 Seats)</span>
                            <div class="flex items-center gap-3">
                                <button @click="form.resources.limos = Math.max(0, form.resources.limos - 1)" class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">-</button>
                                <span class="font-mono text-xl w-6 text-center">{{ form.resources.limos }}</span>
                                <button @click="form.resources.limos = form.resources.limos + 1" class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-else class="w-full max-w-2xl" key="step6">
                 <div class="text-center mb-8">
                    <h1 class="font-serif text-3xl text-onyx mb-2">Arrangement Review</h1>
                    <p class="text-gray-500">Confirm details and generate contract.</p>
                </div>

                <div class="bg-white p-8 rounded-[30px] shadow-lg border border-gold/20">
                    
                    <div class="flex justify-between items-start border-b pb-6 mb-6">
                        <div>
                            <div class="label-pill ml-0">Deceased</div>
                            <div class="font-serif text-2xl">{{ form.deceased.firstName }} {{ form.deceased.lastName }}</div>
                            <div class="text-sm text-gray-500">{{ form.deceased.dob }} — {{ form.deceased.dod }}</div>
                        </div>
                        <div class="text-right">
                             <div class="label-pill ml-0">Service</div>
                             <div class="font-bold">{{ form.disposition.type.toUpperCase() }}</div>
                             <div class="text-sm text-gray-500">{{ form.ceremony.venue }}</div>
                        </div>
                    </div>

                    <div class="space-y-3 mb-8">
                        <div class="flex justify-between text-sm"><span>Professional Fees</span><span class="font-mono">£1,200.00</span></div>
                        <div class="flex justify-between text-sm"><span>Casket ({{ form.resources.coffin }})</span><span class="font-mono">£{{ getCoffinPrice }}</span></div>
                        <div class="flex justify-between text-sm"><span>Limousines (x{{ form.resources.limos }})</span><span class="font-mono">£{{ form.resources.limos * 275 }}</span></div>
                         <div v-if="form.clinical.pacemaker" class="flex justify-between text-sm text-red-600 font-bold"><span>Pacemaker Removal</span><span class="font-mono">£95.00</span></div>
                         <div v-if="form.resources.hearse === 'horse'" class="flex justify-between text-sm"><span>Horse Drawn Upgrade</span><span class="font-mono">£950.00</span></div>
                        
                        <div class="border-t pt-4 flex justify-between items-center mt-4">
                            <span class="font-bold uppercase tracking-widest text-xs">Total Estimate</span>
                            <span class="font-serif text-3xl text-gold">{{ formattedTotal }}</span>
                        </div>
                    </div>

                    <button @click="generatePDF" class="w-full py-4 bg-onyx text-white rounded-full font-bold shadow-lg hover:bg-gray-800 transition flex items-center justify-center gap-3">
                        <i class="fas fa-file-contract"></i> Generate Arrangement Contract
                    </button>
                </div>
            </div>

        </transition>

    </main>

    <footer class="h-24 bg-white border-t border-gray-200 flex items-center justify-between px-6 shrink-0 z-50 pb-safe">
        <button @click="prevStep" :disabled="currentStep === 0" class="px-8 py-3 rounded-full border border-gray-300 font-bold text-gray-500 disabled:opacity-30 hover:bg-gray-50 transition">
            Back
        </button>
        
        <button v-if="currentStep < steps.length - 1" @click="nextStep" class="px-8 py-3 rounded-full bg-gold text-onyx font-bold shadow-lg hover:bg-yellow-500 transition flex items-center gap-2">
            Next Step <i class="fas fa-arrow-right"></i>
        </button>
    </footer>

</div>

<script>
    const { createApp, reactive, computed, ref } = Vue;

    createApp({
        setup() {
            const currentStep = ref(0);
            const steps = ['Identity', 'Timeline', 'Care', 'Service', 'Resources', 'Review'];

            // DEEP DATA STRUCTURE
            const form = reactive({
                deceased: { title: 'Mr', firstName: '', lastName: '', alias: '', dob: '', dod: '', marital: 'Married / Civil Partner', occupation: '', deathPlaceType: 'Hospital (NHS)', deathAddress: '' },
                legal: { coroner: false, coronerOfficer: '' },
                disposition: { type: 'cremation' },
                clinical: { pacemaker: false, embalming: true },
                ceremony: { venue: '', date: '', time: '', dateTbc: true, viewing: 'No Viewing', officiant: '', musicEntry: '', musicExit: '' },
                resources: { coffin: 'Morpeth Oak', hearse: 'motor', limos: 0 }
            });

            // LOGIC
            const nextStep = () => {
                if (currentStep.value < steps.length - 1) currentStep.value++;
            };
            const prevStep = () => {
                if (currentStep.value > 0) currentStep.value--;
            };

            const getCoffinPrice = computed(() => {
                const prices = { 'Morpeth Oak': 0, 'Willow': 650, 'Solid': 1200, 'Cardboard': 200 };
                return prices[form.resources.coffin] || 0;
            });

            const formattedTotal = computed(() => {
                let total = 1200; // Base
                total += getCoffinPrice.value;
                total += (form.resources.limos * 275);
                if (form.resources.hearse === 'horse') total += 950;
                if (form.clinical.pacemaker) total += 95;
                return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(total);
            });

            const generatePDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFont("times", "bold"); doc.setFontSize(22); doc.text("FuneralMatch Arrangement", 20, 20);
                doc.setFontSize(12); doc.setFont("helvetica", "normal");
                
                let y = 40;
                doc.text(`Deceased: ${form.deceased.firstName} ${form.deceased.lastName}`, 20, y); y+=10;
                doc.text(`Date of Death: ${form.deceased.dod}`, 20, y); y+=10;
                doc.text(`Marital Status: ${form.deceased.marital}`, 20, y); y+=10;
                doc.text(`Occupation: ${form.deceased.occupation}`, 20, y); y+=20;
                
                doc.setFont("helvetica", "bold"); doc.text("Service Details", 20, y); y+=10;
                doc.setFont("helvetica", "normal");
                doc.text(`Type: ${form.disposition.type.toUpperCase()}`, 20, y); y+=10;
                doc.text(`Venue: ${form.ceremony.venue}`, 20, y); y+=10;
                doc.text(`Pacemaker: ${form.clinical.pacemaker ? 'YES' : 'NO'}`, 20, y); y+=20;
                
                doc.setFont("helvetica", "bold"); doc.text(`Total Estimate: ${formattedTotal.value}`, 20, y);
                doc.save("Arrangement.pdf");
            };

            return { currentStep, steps, form, nextStep, prevStep, formattedTotal, getCoffinPrice, generatePDF };
        }
    }).mount('#app');
</script>
</body>
</html>
