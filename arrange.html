<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FuneralMatch | Enterprise Core</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --brand: #D4AF37; --dark: #111827; }
        body { background: #F3F4F6; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Transition Effects */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* Custom Form Styling */
        .input-std {
            width: 100%; background: white; border: 1px solid #E5E7EB; border-radius: 8px;
            padding: 12px; font-size: 15px; outline: none; transition: all 0.2s;
        }
        .input-std:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.15); }
        .input-error { border-color: #EF4444; background: #FEF2F2; }
        
        /* Mobile Optimizations */
        .ios-scroll { -webkit-overflow-scrolling: touch; }
    </style>
</head>
<body>

    <div id="app" class="h-screen flex flex-col lg:flex-row overflow-hidden">
        
        <nav class="lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 z-50 pb-safe flex justify-between px-6 py-3">
            <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id"
                class="flex flex-col items-center gap-1 transition-colors"
                :class="currentView === tab.id ? 'text-yellow-600' : 'text-gray-400'">
                <i :class="['fas', tab.icon, 'text-xl']"></i>
                <span class="text-[10px] font-bold uppercase">{{ tab.label }}</span>
            </button>
        </nav>

        <aside class="hidden lg:flex w-64 bg-[#111827] flex-col text-white shrink-0">
            <div class="h-16 flex items-center px-6 border-b border-gray-800 gap-3">
                <div class="w-8 h-8 bg-yellow-600 rounded flex items-center justify-center font-bold text-black">FM</div>
                <div class="font-bold tracking-wide">ENTERPRISE</div>
            </div>
            <div class="p-4 space-y-2">
                <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all"
                    :class="currentView === tab.id ? 'bg-yellow-600 text-black font-bold' : 'text-gray-400 hover:bg-gray-800'">
                    <i :class="['fas', tab.icon, 'w-5 text-center']"></i>
                    <span>{{ tab.label }}</span>
                </button>
            </div>
            <div class="mt-auto p-4 border-t border-gray-800">
                <div class="text-[10px] uppercase text-gray-500 font-bold mb-2">Live Audit Stream</div>
                <div class="h-32 overflow-y-auto font-mono text-[10px] text-green-400 space-y-1 scrollbar-hide">
                    <div v-for="(log, i) in auditLog" :key="i">> {{ log }}</div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-gray-50 relative lg:border-r border-gray-200">
            
            <header class="h-14 bg-white border-b flex items-center justify-between px-4 lg:px-8 shrink-0">
                <div class="flex items-center gap-3">
                    <span class="bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded border border-red-200 animate-pulse">LIVE</span>
                    <h1 class="font-bold text-gray-700 text-sm lg:text-base">Arrangement #{{ caseRef }}</h1>
                </div>
                <div class="lg:hidden font-mono font-bold text-yellow-700">{{ formattedTotal }}</div>
            </header>

            <div class="flex-1 overflow-y-auto ios-scroll p-4 lg:p-8 pb-24 lg:pb-8">
                
                <transition name="fade" mode="out-in">
                    
                    <div v-if="currentView === 'intake'" class="max-w-2xl mx-auto space-y-6">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                            <h2 class="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider">Deceased Profile</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">First Name</label>
                                    <input v-model="form.firstName" @input="log('Updated Name')" class="input-std" :class="{'input-error': !form.firstName && touched}">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Surname</label>
                                    <input v-model="form.lastName" class="input-std">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Date of Birth</label>
                                    <input type="date" v-model="form.dob" class="input-std">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Date of Death</label>
                                    <input type="date" v-model="form.dod" class="input-std">
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <span class="text-xs font-bold text-gray-500">Calculated Age</span>
                                <span class="text-lg font-mono font-bold text-gray-800">{{ calculatedAge }} Years</span>
                            </div>
                        </div>

                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                            <h2 class="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider">Critical Care</h2>
                            <label class="flex items-center justify-between p-3 border rounded-lg mb-2 cursor-pointer transition"
                                :class="form.pacemaker ? 'bg-red-50 border-red-200' : 'bg-gray-50 border-gray-200'">
                                <span class="text-sm font-bold" :class="form.pacemaker ? 'text-red-700' : 'text-gray-600'">Pacemaker Present?</span>
                                <input type="checkbox" v-model="form.pacemaker" @change="log(form.pacemaker ? 'ALERT: Pacemaker Added' : 'Pacemaker Removed')" class="w-5 h-5 accent-red-600">
                            </label>
                            
                            <label class="flex items-center justify-between p-3 border rounded-lg cursor-pointer transition"
                                :class="form.coroner ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'">
                                <span class="text-sm font-bold" :class="form.coroner ? 'text-blue-700' : 'text-gray-600'">Coroner Case?</span>
                                <input type="checkbox" v-model="form.coroner" class="w-5 h-5 accent-blue-600">
                            </label>
                        </div>
                    </div>

                    <div v-else-if="currentView === 'logistics'" class="max-w-2xl mx-auto space-y-6">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                            <h2 class="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider">Service Configuration</h2>
                            <div class="grid grid-cols-1 gap-3">
                                <div v-for="svc in serviceOptions" :key="svc.name" 
                                    @click="selectService(svc)"
                                    class="p-4 border rounded-xl cursor-pointer transition flex items-center justify-between"
                                    :class="form.serviceType === svc.name ? 'border-yellow-500 bg-yellow-50 ring-1 ring-yellow-500' : 'border-gray-200 hover:border-gray-300'">
                                    <div>
                                        <div class="font-bold text-gray-800">{{ svc.name }}</div>
                                        <div class="text-xs text-gray-500">{{ svc.desc }}</div>
                                    </div>
                                    <div class="font-bold text-gray-900">£{{ svc.price }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                            <h2 class="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider">Fleet Management</h2>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold text-gray-800">Limousines</div>
                                    <div class="text-xs text-gray-500">Mercedes E-Class (7 Seats)</div>
                                </div>
                                <div class="flex items-center bg-gray-100 rounded-lg p-1">
                                    <button @click="adjustLimos(-1)" class="w-10 h-10 bg-white shadow rounded flex items-center justify-center active:scale-95 transition"><i class="fas fa-minus text-xs"></i></button>
                                    <span class="w-10 text-center font-bold text-lg">{{ form.limos }}</span>
                                    <button @click="adjustLimos(1)" class="w-10 h-10 bg-white shadow rounded flex items-center justify-center active:scale-95 transition"><i class="fas fa-plus text-xs"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-else class="max-w-2xl mx-auto space-y-6">
                        <div class="bg-[#1F2937] text-white p-6 rounded-xl shadow-lg">
                            <div class="text-[10px] uppercase font-bold text-gray-400 mb-1">Total Estimated Cost</div>
                            <div class="text-4xl font-mono font-bold text-[#D4AF37]">{{ formattedTotal }}</div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="text-left p-4 font-bold text-gray-500 uppercase text-[10px]">Description</th>
                                        <th class="text-right p-4 font-bold text-gray-500 uppercase text-[10px]">Amount</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    <tr v-if="selectedServiceObj">
                                        <td class="p-4 text-gray-800 font-medium">{{ selectedServiceObj.name }}</td>
                                        <td class="p-4 text-right font-mono text-gray-600">£{{ selectedServiceObj.price }}</td>
                                    </tr>
                                    <tr v-if="form.limos > 0">
                                        <td class="p-4 text-gray-800 font-medium">Limousines (x{{ form.limos }})</td>
                                        <td class="p-4 text-right font-mono text-gray-600">£{{ form.limos * 250 }}</td>
                                    </tr>
                                    <tr v-if="form.pacemaker">
                                        <td class="p-4 text-red-600 font-bold flex items-center gap-2">
                                            <i class="fas fa-heart-broken"></i> Pacemaker Removal
                                        </td>
                                        <td class="p-4 text-right font-mono text-red-600">£95</td>
                                    </tr>
                                    <tr>
                                        <td class="p-4 text-gray-800 font-medium">Professional Fees</td>
                                        <td class="p-4 text-right font-mono text-gray-600">£1,200</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <button @click="saveArrangement" class="w-full py-4 bg-[#D4AF37] text-white font-bold text-lg rounded-xl shadow-lg active:scale-[0.98] transition">
                            <i class="fas fa-file-contract mr-2"></i> Finalize Arrangement
                        </button>
                    </div>

                </transition>
            </div>
        </main>

        <aside class="hidden lg:block w-80 bg-white border-l border-gray-200 p-6 shrink-0 z-20 shadow-xl">
            <div class="text-xs font-bold text-gray-400 uppercase mb-4">Live Financials</div>
            <div class="text-3xl font-mono font-bold text-[#D4AF37] mb-6 border-b border-gray-100 pb-6">{{ formattedTotal }}</div>
            
            <div class="text-xs font-bold text-gray-400 uppercase mb-4">Risk Matrix</div>
            <div class="space-y-2">
                <div v-if="!hasRisks" class="text-xs text-gray-400 italic bg-gray-50 p-3 rounded">No active risks identified.</div>
                <div v-if="form.pacemaker" class="flex items-center gap-2 p-2 bg-red-50 text-red-700 rounded text-xs font-bold border border-red-100">
                    <i class="fas fa-exclamation-triangle"></i> Pacemaker Removal
                </div>
                <div v-if="form.coroner" class="flex items-center gap-2 p-2 bg-blue-50 text-blue-700 rounded text-xs font-bold border border-blue-100">
                    <i class="fas fa-file-medical"></i> Coroner Protocol
                </div>
                <div v-if="calculatedAge !== '0' && calculatedAge < 18" class="flex items-center gap-2 p-2 bg-purple-50 text-purple-700 rounded text-xs font-bold border border-purple-100">
                    <i class="fas fa-child"></i> Child Fund Protocol
                </div>
            </div>
        </aside>

    </div>

    <script>
        const { createApp, reactive, computed, ref } = Vue;

        createApp({
            setup() {
                // --- STATE ---
                const currentView = ref('intake');
                const touched = ref(false);
                const caseRef = ref(`FM-${new Date().getFullYear()}-${Math.floor(Math.random() * 9000)}`);
                const auditLog = reactive([`System initialized for Case #${caseRef.value}`]);
                
                const tabs = [
                    { id: 'intake', label: 'Intake', icon: 'fa-user' },
                    { id: 'logistics', label: 'Logistics', icon: 'fa-truck' },
                    { id: 'finance', label: 'Financials', icon: 'fa-file-invoice-dollar' }
                ];

                const serviceOptions = [
                    { name: 'Direct Cremation', price: 950, desc: 'Unattended service' },
                    { name: 'Simple Service', price: 1800, desc: 'Chapel service, standard hours' },
                    { name: 'Traditional', price: 2600, desc: 'Full service with cortege' }
                ];

                // Reactive Form Data
                const form = reactive({
                    firstName: '',
                    lastName: '',
                    dob: '',
                    dod: '',
                    pacemaker: false,
                    coroner: false,
                    serviceType: 'Simple Service',
                    limos: 0
                });

                // --- LOGIC ---
                const log = (msg) => {
                    const time = new Date().toLocaleTimeString([], { hour12: false });
                    auditLog.unshift(`[${time}] ${msg}`);
                };

                const selectService = (svc) => {
                    form.serviceType = svc.name;
                    log(`Service changed to: ${svc.name}`);
                };

                const adjustLimos = (delta) => {
                    let n = form.limos + delta;
                    if(n < 0) n = 0; if(n > 10) n = 10;
                    form.limos = n;
                    log(`Fleet updated: ${n} Limousines`);
                };

                // --- COMPUTED ENGINES ---
                const selectedServiceObj = computed(() => serviceOptions.find(s => s.name === form.serviceType));
                
                const totalCost = computed(() => {
                    let total = 1200; // Prof Fees
                    if (selectedServiceObj.value) total += selectedServiceObj.value.price;
                    total += (form.limos * 250);
                    if (form.pacemaker) total += 95;
                    return total;
                });

                const formattedTotal = computed(() => {
                    return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(totalCost.value);
                });

                const calculatedAge = computed(() => {
                    if(!form.dob || !form.dod) return '0';
                    const start = new Date(form.dob);
                    const end = new Date(form.dod);
                    const diff = end - start;
                    return Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
                });

                const hasRisks = computed(() => form.pacemaker || form.coroner || (calculatedAge.value > 0 && calculatedAge.value < 18));

                const saveArrangement = () => {
                    if(!form.firstName || !form.lastName) {
                        touched.value = true;
                        alert("Validation Error: Please complete Deceased Profile.");
                        currentView.value = 'intake';
                        return;
                    }
                    alert(`✅ ARRANGEMENT SAVED\n\nRef: ${caseRef.value}\nTotal Value: ${formattedTotal.value}\n\nData committed to local store.`);
                    log('** DATA COMMITTED TO DATABASE **');
                };

                return {
                    currentView, tabs, form, serviceOptions,
                    auditLog, log,
                    selectService, adjustLimos,
                    selectedServiceObj, totalCost, formattedTotal, calculatedAge, hasRisks,
                    touched, saveArrangement, caseRef
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
