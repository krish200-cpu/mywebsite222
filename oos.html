<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FuneralMatch Scrolling Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- 1. CORE SETUP --- */
        :root {
            --bg: #050505;
            --surface: #121212;
            --border: #222;
            --gold: #D4AF37;
            --page-ratio: 1.414; /* A-Series Ratio */
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Inter', sans-serif;
            /* Allow natural scrolling */
            min-height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* --- 2. HEADER (Sticky) --- */
        .top-bar {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* --- 3. THE LONG SCROLL WORKSPACE --- */
        .workspace {
            width: 100%;
            max-width: 600px; /* Constrain width for desktop readability */
            margin: 0 auto;
            padding: 40px 20px 140px 20px; /* Huge bottom padding for the Dock */
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        /* The Page Card */
        .page-card {
            width: 100%;
            aspect-ratio: 1 / var(--page-ratio);
            background: white;
            color: black;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* Focus State (When editing) */
        .page-card.focused {
            box-shadow: 0 0 0 4px var(--gold), 0 30px 60px rgba(0,0,0,0.7);
            z-index: 10;
            transform: scale(1.02);
        }

        .page-label {
            position: absolute;
            top: -25px;
            left: 0;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: #666;
            letter-spacing: 1px;
            background: var(--bg);
            padding-right: 10px;
        }

        /* --- 4. CONTENT & EDITING --- */
        .content-area {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .editable {
            border: 1px dashed transparent;
            cursor: pointer;
            transition: 0.2s;
            padding: 4px;
            border-radius: 4px;
        }
        .editable:hover {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.05);
        }

        .photo-zone {
            background: #f4f4f4;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            color: #ccc;
            transition: 0.2s;
        }
        .photo-zone:hover { opacity: 0.9; }
        .photo-zone img { width: 100%; height: 100%; object-fit: cover; }

        /* --- 5. FIXED BOTTOM DOCK --- */
        .dock {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 16px 20px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 60;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }

        .btn-pill {
            height: 44px;
            padding: 0 24px;
            border-radius: 99px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .btn-gold { background: var(--gold); color: black; }
        .btn-gold:active { transform: scale(0.96); background: white; }

        .btn-dark { background: #222; color: white; border: 1px solid #333; }
        .btn-dark:active { background: #333; }

        /* --- 6. PREVIEW MODAL (3D Flip) --- */
        #preview-overlay {
            position: fixed; inset: 0; z-index: 100;
            background: #050505;
            display: none; flex-direction: column;
        }
        #preview-overlay.active { display: flex; }

        .book-stage {
            flex: 1; display: flex; align-items: center; justify-content: center;
            perspective: 1500px; overflow: hidden;
        }
        .book-spine {
            width: 300px; height: 424px; position: relative; transform-style: preserve-3d;
            transition: transform 0.6s ease;
        }
        .sheet-3d {
            position: absolute; inset: 0; background: white; backface-visibility: hidden;
            transform-origin: left center; transition: transform 0.6s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center; text-align: center;
            overflow: hidden;
        }
        .sheet-3d.flipped { transform: rotateY(-180deg); }

        /* --- 7. EDIT DRAWER --- */
        #edit-drawer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #1a1a1a; border-radius: 20px 20px 0 0;
            padding: 24px; transform: translateY(100%); transition: transform 0.3s ease;
            z-index: 70; border-top: 1px solid #333; box-shadow: 0 -20px 50px black;
        }
        #edit-drawer.open { transform: translateY(0); }

        textarea.input-edit {
            width: 100%; background: #000; border: 1px solid #333; color: white;
            padding: 16px; border-radius: 12px; font-size: 16px; min-height: 120px; outline: none;
            margin-bottom: 16px;
        }
        textarea.input-edit:focus { border-color: var(--gold); }

        /* Typography */
        .font-classic { font-family: 'Bodoni Moda', serif; }
        .font-modern { font-family: 'Inter', sans-serif; font-weight: 600; text-transform: uppercase; }
        .font-script { font-family: 'Cormorant Garamond', serif; font-style: italic; }

    </style>
</head>
<body>

    <div class="top-bar">
        <div class="flex flex-col">
            <span class="text-[9px] uppercase font-bold text-[#D4AF37] tracking-widest">FuneralMatch</span>
            <span class="text-xs font-bold text-white">Linear Editor</span>
        </div>
        <div class="flex items-center gap-3">
            <div class="px-3 py-1 bg-[#1a1a1a] rounded border border-[#333] flex items-center gap-2">
                <i class="fas fa-camera text-gray-500 text-[10px]"></i>
                <span id="photo-count" class="text-[10px] font-bold text-white">0/5</span>
            </div>
            <span id="total-price" class="text-sm font-bold text-[#D4AF37]">£80.00</span>
        </div>
    </div>

    <div class="workspace" id="workspace">
        </div>

    <div class="dock">
        <div class="flex gap-2">
            <button class="w-10 h-10 rounded-full bg-[#1a1a1a] border border-[#333] text-gray-400 flex items-center justify-center hover:text-white" onclick="changePages()">
                <span class="text-[10px] font-bold">4p</span>
            </button>
            <button class="w-10 h-10 rounded-full bg-[#1a1a1a] border border-[#333] text-gray-400 flex items-center justify-center hover:text-white" onclick="toggleTheme()">
                <span class="font-serif text-xs">Aa</span>
            </button>
        </div>

        <div class="flex gap-3">
            <button class="btn-dark" onclick="openPreview()">
                <i class="fas fa-eye"></i> Preview
            </button>
            <button class="btn-gold" onclick="alert('Saving Design...')">
                Save & Print
            </button>
        </div>
    </div>

    <div id="preview-overlay">
        <div class="h-16 flex items-center justify-between px-6 border-b border-white/10">
            <span class="text-xs font-bold text-white">Booklet Preview</span>
            <button onclick="closePreview()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="book-stage">
            <div class="book-spine" id="book-spine">
                </div>
        </div>
        <div class="h-24 flex items-center justify-center gap-8 text-2xl text-white/50">
            <button onclick="flipBack()" class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center hover:bg-white/10"><i class="fas fa-arrow-left text-sm"></i></button>
            <button onclick="flipForward()" class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center hover:bg-white/10"><i class="fas fa-arrow-right text-sm"></i></button>
        </div>
    </div>

    <div id="edit-drawer">
        <div class="flex justify-between items-center mb-4">
            <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Edit Text</span>
            <button onclick="closeDrawer()" class="text-gray-500"><i class="fas fa-times"></i></button>
        </div>
        <textarea id="drawer-input" class="input-edit"></textarea>
        <button onclick="saveDrawer()" class="w-full h-12 bg-[#D4AF37] text-black font-bold rounded-lg text-xs uppercase tracking-widest">Update Text</button>
    </div>

    <input type="file" id="img-upload" class="hidden" accept="image/*">

    <script>
        // === STATE ===
        const state = {
            pageCount: 4,
            pages: [],
            theme: 'classic',
            previewIndex: 0
        };

        const TEMPLATES = {
            cover: `
                <div class="h-full flex flex-col items-center justify-center text-center p-4">
                    <p class="editable text-xs uppercase tracking-[0.2em] text-gray-500 mb-6" onclick="edit(this)">In Loving Memory of</p>
                    <div class="photo-zone rounded-full w-32 h-32 mb-6 shadow-xl border-4 border-double border-gray-100" onclick="upload(this)">
                        <i class="fas fa-camera text-2xl opacity-20"></i>
                    </div>
                    <h1 class="editable text-3xl mb-2 leading-tight font-serif" onclick="edit(this)">Name<br>Here</h1>
                    <p class="editable text-sm mb-6 text-gray-600" onclick="edit(this)">1950 — 2026</p>
                    <p class="editable text-[10px] uppercase font-bold text-gray-400" onclick="edit(this)">St Mary's Church</p>
                </div>`,
            
            text: `
                <div class="h-full p-8 text-left">
                    <h2 class="editable text-lg font-bold mb-4 border-b border-gray-200 pb-2" onclick="edit(this)">Reading</h2>
                    <p class="editable text-sm leading-loose text-gray-600 whitespace-pre-wrap" onclick="edit(this)">
Tap to edit text. 
You can add poems, eulogies, or order of service details here.
                    </p>
                </div>`,
                
            back: `
                <div class="h-full flex flex-col items-center justify-end pb-8 text-center p-4">
                    <div class="photo-zone w-20 h-20 mb-4 rounded bg-gray-100" onclick="upload(this)">
                        <i class="fas fa-plus opacity-20"></i>
                    </div>
                    <h3 class="editable font-bold mb-2 text-sm" onclick="edit(this)">Donations</h3>
                    <p class="editable text-xs text-gray-500 w-3/4 mx-auto" onclick="edit(this)">To The Hospice Charity.</p>
                </div>`
        };

        // === INIT ===
        function init() {
            resetPages(4);
        }

        function resetPages(count) {
            state.pageCount = count;
            state.pages = [];
            
            // Build Data
            for(let i=0; i<count; i++) {
                let content = TEMPLATES.text;
                if(i === 0) content = TEMPLATES.cover;
                if(i === count - 1) content = TEMPLATES.back;
                
                state.pages.push({ id: i, html: content });
            }
            renderWorkspace();
        }

        // === RENDER WORKSPACE (The List) ===
        function renderWorkspace() {
            const container = document.getElementById('workspace');
            container.innerHTML = ''; // Clear

            state.pages.forEach((page, i) => {
                const card = document.createElement('div');
                card.className = `page-card font-${state.theme}`;
                card.id = `card-${i}`;
                
                let label = `Page ${i+1}`;
                if(i===0) label = "Front Cover";
                else if(i===state.pageCount-1) label = "Back Cover";

                card.innerHTML = `
                    <div class="page-label">${label}</div>
                    <div class="content-area" id="content-${i}">
                        ${page.html}
                    </div>
                `;
                
                // Focus Effect
                card.onclick = () => {
                    document.querySelectorAll('.page-card').forEach(c => c.classList.remove('focused'));
                    card.classList.add('focused');
                };

                container.appendChild(card);
            });
        }

        // === EDITING LOGIC ===
        let activeEl = null;

        function edit(el) {
            activeEl = el;
            const drawer = document.getElementById('edit-drawer');
            const input = document.getElementById('drawer-input');
            input.value = el.innerText;
            drawer.classList.add('open');
            // Wait for slide up then focus
            setTimeout(() => input.focus(), 300);
        }

        function saveDrawer() {
            if(activeEl) {
                activeEl.innerText = document.getElementById('drawer-input').value;
                // Update state memory
                const pageIndex = activeEl.closest('.page-card').id.split('-')[1];
                state.pages[pageIndex].html = document.getElementById(`content-${pageIndex}`).innerHTML;
            }
            closeDrawer();
        }

        function closeDrawer() {
            document.getElementById('edit-drawer').classList.remove('open');
            document.getElementById('drawer-input').blur();
        }

        // === PHOTO UPLOAD ===
        let activePhoto = null;
        function upload(el) {
            activePhoto = el;
            document.getElementById('img-upload').click();
        }

        document.getElementById('img-upload').onchange = (e) => {
            if(e.target.files[0] && activePhoto) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    activePhoto.innerHTML = `<img src="${evt.target.result}">`;
                    // Update state
                    const pageIndex = activePhoto.closest('.page-card').id.split('-')[1];
                    state.pages[pageIndex].html = document.getElementById(`content-${pageIndex}`).innerHTML;
                    updatePrice(1); // Increment photo count
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        };

        function updatePrice(photoIncrement = 0) {
            // Simplified counter for demo
            let current = parseInt(document.getElementById('photo-count').innerText.split('/')[0]);
            current += photoIncrement;
            document.getElementById('photo-count').innerText = `${current}/5`;
            
            let price = 80;
            if(state.pageCount > 4) price += (state.pageCount - 4) * 10; // £10 per extra page (simplified)
            if(current > 5) price += (current - 5) * 7.50;
            
            document.getElementById('total-price').innerText = `£${price.toFixed(2)}`;
        }

        // === PREVIEW (3D) ===
        function openPreview() {
            const spine = document.getElementById('book-spine');
            spine.innerHTML = '';
            
            state.pages.forEach((page, i) => {
                const sheet = document.createElement('div');
                sheet.className = `sheet-3d font-${state.theme}`;
                sheet.id = `sheet-${i}`;
                sheet.style.zIndex = state.pageCount - i;
                // Clone content
                sheet.innerHTML = `<div class="w-full h-full p-8 border-l border-gray-200 overflow-hidden text-black text-center flex flex-col justify-center items-center bg-white">${page.html}</div>`;
                spine.appendChild(sheet);
            });
            
            state.previewIndex = 0;
            document.getElementById('preview-overlay').classList.add('active');
        }

        function closePreview() {
            document.getElementById('preview-overlay').classList.remove('active');
        }

        function flipForward() {
            if(state.previewIndex < state.pageCount - 1) {
                document.getElementById(`sheet-${state.previewIndex}`).classList.add('flipped');
                state.previewIndex++;
            }
        }

        function flipBack() {
            if(state.previewIndex > 0) {
                state.previewIndex--;
                document.getElementById(`sheet-${state.previewIndex}`).classList.remove('flipped');
            }
        }

        // === GLOBAL TOOLS ===
        function changePages() {
            const count = state.pageCount === 4 ? 8 : (state.pageCount === 8 ? 12 : 4);
            if(confirm(`Change to ${count} pages? This resets the layout.`)) {
                resetPages(count);
                updatePrice();
            }
        }

        function toggleTheme() {
            if(state.theme === 'classic') state.theme = 'modern';
            else if(state.theme === 'modern') state.theme = 'script';
            else state.theme = 'classic';
            renderWorkspace();
        }

        // Start
        init();

    </script>
</body>
</html>
