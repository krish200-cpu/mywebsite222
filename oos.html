<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FuneralMatch Page Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg: #050505;
            --surface: #121212;
            --border: #222;
            --gold: #D4AF37;
            --page-width: 400px;  /* Base reference width */
            --page-height: 565px; /* A5 Ratio approx */
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Inter', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 3D STAGE --- */
        #stage {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 2000px; /* Deep 3D space */
            overflow: hidden;
            background-image: radial-gradient(#1a1a1a 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Container that holds the pages */
        .book-container {
            width: var(--page-width);
            height: var(--page-height);
            position: relative;
            transform-style: preserve-3d;
            /* Auto-scale for mobile via JS */
            transition: transform 0.3s ease; 
        }

        /* --- THE PAGE (Physical Object) --- */
        .sheet {
            position: absolute;
            inset: 0;
            background: white;
            color: black;
            box-shadow: 
                0 4px 10px rgba(0,0,0,0.1), /* Close shadow */
                0 20px 50px rgba(0,0,0,0.5); /* Deep shadow */
            transform-origin: left center; /* Hinge on the left spine */
            backface-visibility: hidden;
            border-radius: 2px 6px 6px 2px; /* Slight curve on right edge */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1); /* Smooth "Paper" Bezier */
        }

        /* Page States */
        .sheet.active { z-index: 10; transform: rotateY(0deg); }
        .sheet.flipped { z-index: 20; transform: rotateY(-180deg); } /* Gone to left */
        .sheet.upcoming { z-index: 1; transform: rotateY(0deg) scale(0.95) translateZ(-10px); opacity: 0; } /* Waiting in stack */

        /* Paper Texture Overlay */
        .texture {
            position: absolute; inset: 0; pointer-events: none;
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            opacity: 0.5; mix-blend-mode: multiply; z-index: 50;
        }

        /* Spine Highlight */
        .spine-highlight {
            position: absolute; top: 0; bottom: 0; left: 0; width: 40px;
            background: linear-gradient(to right, rgba(0,0,0,0.1), transparent);
            pointer-events: none; z-index: 40;
        }

        /* --- CONTENT STYLES --- */
        .page-content {
            flex: 1; padding: 40px;
            display: flex; flex-direction: column;
            position: relative;
        }

        .editable {
            border: 1px dashed transparent; cursor: pointer; transition: 0.2s;
        }
        .editable:hover { border-color: var(--gold); background: rgba(212, 175, 55, 0.05); }

        .photo-zone {
            background: #f4f4f4; width: 100%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden; position: relative; color: #ccc;
        }
        .photo-zone:hover { color: var(--gold); background: #eee; }
        .photo-zone img { width: 100%; height: 100%; object-fit: cover; }

        /* --- UI OVERLAY --- */
        .ui-layer {
            position: absolute; inset: 0; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 20px; z-index: 100;
        }

        .top-bar {
            pointer-events: auto;
            background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(10px);
            border: 1px solid var(--border); border-radius: 99px;
            padding: 8px 20px;
            display: flex; align-items: center; justify-content: space-between;
            align-self: center; width: 100%; max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .bottom-bar {
            pointer-events: auto;
            background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(10px);
            border: 1px solid var(--border); border-radius: 16px;
            padding: 16px;
            align-self: center; width: 100%; max-width: 600px;
            display: flex; flex-direction: column; gap: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .nav-row { display: flex; justify-content: space-between; align-items: center; }
        
        .scrubber { flex: 1; margin: 0 20px; position: relative; height: 4px; background: #333; border-radius: 2px; }
        .scrubber-fill { height: 100%; background: var(--gold); width: 0%; transition: width 0.3s; border-radius: 2px; }

        .btn-icon {
            width: 44px; height: 44px; border-radius: 50%;
            background: #222; color: white; border: 1px solid #333;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .btn-icon:hover { border-color: var(--gold); color: var(--gold); }
        .btn-icon:active { transform: scale(0.95); }

        .layout-tray {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
            padding-top: 16px; border-top: 1px solid #333;
        }
        .layout-opt {
            background: #000; border: 1px solid #333; border-radius: 6px;
            height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; opacity: 0.6; transition: 0.2s;
        }
        .layout-opt:hover { opacity: 1; border-color: #666; }
        .layout-opt.active { opacity: 1; border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }

    </style>
</head>
<body>

    <div class="ui-layer">
        
        <div class="top-bar">
            <div class="flex flex-col">
                <span class="text-[8px] uppercase font-bold text-[#C5A059] tracking-widest">FuneralMatch</span>
                <span class="text-xs font-bold">Studio</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <i class="fas fa-camera text-gray-500 text-xs"></i>
                    <span class="text-xs font-bold text-gray-300" id="photo-count">0/5</span>
                </div>
                <div class="h-4 w-px bg-white/20"></div>
                <span class="text-xs font-bold text-[#C5A059]">£80.00</span>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="nav-row">
                <button class="btn-icon" onclick="prevPage()"><i class="fas fa-arrow-left"></i></button>
                
                <div class="flex-1 flex flex-col items-center px-4">
                    <span class="text-[10px] uppercase font-bold text-gray-400 mb-2" id="page-label">Page 1: Front Cover</span>
                    <div class="scrubber"><div class="scrubber-fill" id="progress-bar"></div></div>
                </div>

                <button class="btn-icon" onclick="nextPage()"><i class="fas fa-arrow-right"></i></button>
            </div>

            <div class="layout-tray">
                <div class="layout-opt" onclick="applyLayout('cover')">
                    <i class="fas fa-book text-gray-400 mb-1 text-xs"></i>
                    <span class="text-[8px] uppercase text-gray-500">Cover</span>
                </div>
                <div class="layout-opt" onclick="applyLayout('text')">
                    <i class="fas fa-align-left text-gray-400 mb-1 text-xs"></i>
                    <span class="text-[8px] uppercase text-gray-500">Text</span>
                </div>
                <div class="layout-opt" onclick="applyLayout('photo')">
                    <i class="fas fa-image text-gray-400 mb-1 text-xs"></i>
                    <span class="text-[8px] uppercase text-gray-500">Photo</span>
                </div>
                <div class="layout-opt" onclick="applyLayout('hymn')">
                    <i class="fas fa-music text-gray-400 mb-1 text-xs"></i>
                    <span class="text-[8px] uppercase text-gray-500">Hymn</span>
                </div>
            </div>
        </div>

    </div>

    <div id="stage">
        <div class="book-container" id="book">
            </div>
    </div>

    <input type="file" id="img-upload" class="hidden" accept="image/*">

    <script>
        // === STATE ===
        const state = {
            totalPages: 8, // Rectangular pages (A5)
            currentPage: 0, // 0-based index
            pages: [],
            price: 80,
            photos: 0
        };

        const TEMPLATES = {
            cover: `
                <div class="h-full flex flex-col items-center justify-center text-center">
                    <p class="editable text-xs uppercase tracking-widest text-gray-500 mb-8" onclick="editText(this)">In Loving Memory</p>
                    <div class="photo-zone rounded-full w-40 h-40 mb-8 shadow-xl border-4 border-double border-gray-100" onclick="uploadPhoto(this)">
                        <i class="fas fa-camera opacity-30 text-2xl"></i>
                    </div>
                    <h1 class="editable text-4xl mb-2 font-serif" onclick="editText(this)">Name<br>Here</h1>
                    <p class="editable text-sm mb-8" onclick="editText(this)">1950 — 2026</p>
                    <p class="editable text-[10px] uppercase font-bold text-gray-400" onclick="editText(this)">St Mary's Church</p>
                </div>`,
            
            text: `
                <div class="h-full p-8 text-left">
                    <h2 class="editable text-xl font-bold mb-4 border-b border-gray-200 pb-2" onclick="editText(this)">Reading</h2>
                    <p class="editable text-xs leading-loose text-gray-600 whitespace-pre-wrap" onclick="editText(this)">
Tap to edit text. You can add poems, eulogies, or order of service details here.
                    </p>
                </div>`,
            
            photo: `
                <div class="h-full flex flex-col">
                    <div class="photo-zone w-full h-1/2 mb-6 bg-gray-100" onclick="uploadPhoto(this)">
                        <div class="flex flex-col items-center"><i class="fas fa-image opacity-30 mb-2"></i><span class="text-[8px] uppercase font-bold opacity-30">Add Photo</span></div>
                    </div>
                    <div class="px-6">
                        <h2 class="editable text-xl font-bold mb-2" onclick="editText(this)">Caption</h2>
                        <p class="editable text-xs text-gray-600" onclick="editText(this)">Add a description...</p>
                    </div>
                </div>`,
            
            hymn: `
                <div class="h-full flex flex-col items-center justify-start pt-12 text-center px-6">
                    <p class="text-[9px] uppercase font-bold text-gray-300 mb-2">Hymn</p>
                    <h2 class="editable text-2xl italic mb-6 font-serif" onclick="editText(this)">Abide With Me</h2>
                    <div class="editable text-xs font-serif italic text-gray-600 leading-relaxed" onclick="editText(this)">
Abide with me; fast falls the eventide;
The darkness deepens; Lord with me abide.
When other helpers fail and comforts flee,
Help of the helpless, O abide with me.
                    </div>
                </div>`
        };

        // === INIT ===
        function init() {
            // Build pages
            for(let i=0; i<state.totalPages; i++) {
                let content = TEMPLATES.text;
                if(i === 0) content = TEMPLATES.cover;
                
                state.pages.push({
                    id: i,
                    content: content,
                    layout: i === 0 ? 'cover' : 'text'
                });
            }
            
            renderBook();
            updateUI();
            autoScale();
            window.addEventListener('resize', autoScale);
        }

        // === RENDERING (The 3D Engine) ===
        function renderBook() {
            const container = document.getElementById('book');
            container.innerHTML = '';

            state.pages.forEach((page, index) => {
                const sheet = document.createElement('div');
                sheet.className = `sheet font-serif`; // Default font
                sheet.id = `page-${index}`;
                sheet.innerHTML = `
                    <div class="texture"></div>
                    <div class="spine-highlight"></div>
                    <div class="page-content" id="content-${index}">
                        ${page.content}
                    </div>
                `;
                
                // Z-Index Stacking: Lower pages are behind
                sheet.style.zIndex = state.totalPages - index;
                
                // Initial State
                if (index < state.currentPage) {
                    sheet.classList.add('flipped');
                } else if (index === state.currentPage) {
                    sheet.classList.add('active');
                } else {
                    sheet.classList.add('upcoming');
                }

                container.appendChild(sheet);
            });
        }

        // === NAVIGATION (The Flip Logic) ===
        function nextPage() {
            if (state.currentPage < state.totalPages - 1) {
                // Animate current page flipping away
                const currentEl = document.getElementById(`page-${state.currentPage}`);
                currentEl.classList.remove('active');
                currentEl.classList.add('flipped');

                state.currentPage++;

                // Animate next page appearing
                const nextEl = document.getElementById(`page-${state.currentPage}`);
                nextEl.classList.remove('upcoming');
                nextEl.classList.add('active');

                updateUI();
            }
        }

        function prevPage() {
            if (state.currentPage > 0) {
                // Animate current page disappearing (becoming upcoming)
                const currentEl = document.getElementById(`page-${state.currentPage}`);
                currentEl.classList.remove('active');
                currentEl.classList.add('upcoming');

                state.currentPage--;

                // Animate prev page flipping back
                const prevEl = document.getElementById(`page-${state.currentPage}`);
                prevEl.classList.remove('flipped');
                prevEl.classList.add('active');

                updateUI();
            }
        }

        function updateUI() {
            // Label
            let label = `Page ${state.currentPage + 1}`;
            if (state.currentPage === 0) label += ": Front Cover";
            else if (state.currentPage === state.totalPages - 1) label += ": Back Cover";
            document.getElementById('page-label').innerText = label;

            // Progress Bar
            const pct = ((state.currentPage + 1) / state.totalPages) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;
        }

        // === SCALING (Responsive) ===
        function autoScale() {
            const stage = document.getElementById('stage');
            const book = document.getElementById('book');
            
            const w = stage.clientWidth;
            const h = stage.clientHeight;
            
            // Margins
            const padX = 40;
            const padY = 160; // Space for UI

            const baseW = 400; // From CSS var
            const baseH = 565;

            const scale = Math.min(
                (w - padX) / baseW,
                (h - padY) / baseH
            );

            // Limit max scale to 1.2 to avoid pixelation
            const finalScale = Math.min(scale, 1.2);
            
            book.style.transform = `scale(${finalScale})`;
        }

        // === EDITING ===
        function applyLayout(type) {
            const idx = state.currentPage;
            state.pages[idx].content = TEMPLATES[type];
            document.getElementById(`content-${idx}`).innerHTML = TEMPLATES[type];
        }

        function editText(el) {
            const newText = prompt("Edit content:", el.innerText);
            if (newText !== null) el.innerText = newText;
        }

        let uploadTarget = null;
        function uploadPhoto(el) {
            uploadTarget = el;
            document.getElementById('img-upload').click();
        }

        document.getElementById('img-upload').onchange = (e) => {
            if (e.target.files && e.target.files[0] && uploadTarget) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    uploadTarget.innerHTML = `<img src="${evt.target.result}">`;
                    uploadTarget.style.backgroundColor = 'transparent';
                    uploadTarget.style.border = 'none';
                    state.photos++;
                    document.getElementById('photo-count').innerText = `${state.photos}/5`;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        };

        // Run
        init();

    </script>
</body>
</html>
