<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FuneralMatch | Ethereal Studio</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@400;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- 1. ETHEREAL DESIGN SYSTEM --- */
        :root {
            --bg-deep: #000000;
            --bg-glass: rgba(20, 20, 20, 0.7);
            --border-glass: rgba(255, 255, 255, 0.08);
            
            --gold-primary: #D4AF37;
            --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%);
            --gold-glow: 0 0 20px rgba(212, 175, 55, 0.3);
            
            --radius-soft: 32px;
            --radius-pill: 999px;
            
            --page-ratio: 1.414; /* A-Series */
            --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* --- 2. GLOBAL RESET --- */
        html { background: var(--bg-deep); scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; color: white;
            min-height: 100vh; overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 50% 0%, #1a1a1a 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, #0f0f0f 0%, transparent 40%);
            display: flex; flex-direction: column;
        }

        /* --- 3. HEADER (Floating Island) --- */
        .header-island {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px; height: 64px;
            background: rgba(15, 15, 15, 0.85); backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-pill);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 8px 0 24px;
            z-index: 50;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }

        .logo-text { font-family: 'Bodoni Moda', serif; font-weight: 700; letter-spacing: 0.05em; font-size: 16px; }
        .logo-sub { font-size: 9px; text-transform: uppercase; color: var(--gold-primary); letter-spacing: 0.15em; font-weight: 700; }

        .price-pill {
            background: #222; padding: 8px 16px; border-radius: var(--radius-pill);
            font-size: 12px; font-weight: 600; color: white; border: 1px solid #333;
            transition: 0.3s;
        }
        .price-pill.updated { border-color: var(--gold-primary); color: var(--gold-primary); transform: scale(1.05); }

        /* --- 4. CANVAS (The Desk) --- */
        .workspace {
            flex: 1; padding: 120px 20px 160px 20px;
            display: flex; flex-direction: column; align-items: center; gap: 40px;
        }

        /* The Sheet (Physical Feel) */
        .sheet-card {
            position: relative;
            width: 100%; max-width: 500px;
            aspect-ratio: 1 / var(--page-ratio);
            background: white; color: black;
            border-radius: var(--radius-soft); /* Soft Corners per request */
            box-shadow: 0 30px 80px -20px rgba(0,0,0,0.7);
            transition: transform 0.4s var(--ease-elastic), box-shadow 0.4s ease;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Active Focus State */
        .sheet-card.active {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px var(--gold-primary), 0 40px 100px -20px rgba(0,0,0,0.9);
            z-index: 10;
        }

        /* Page Badge */
        .page-badge {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.05); padding: 4px 12px;
            border-radius: var(--radius-pill);
            font-size: 9px; font-weight: 700; text-transform: uppercase; color: #888;
            pointer-events: none;
        }

        /* --- 5. EDITABLE CONTENT --- */
        .content-wrap { flex: 1; padding: 40px; display: flex; flex-direction: column; }

        [contenteditable] {
            outline: none; border: 1px dashed transparent; border-radius: 8px;
            transition: 0.2s; cursor: text;
        }
        [contenteditable]:hover { background: rgba(0,0,0,0.03); }
        [contenteditable]:focus { 
            background: rgba(212, 175, 55, 0.08); 
            border-color: rgba(212, 175, 55, 0.3);
        }

        /* Photo Uploaders */
        .photo-slot {
            width: 100%; background: #f4f4f4; 
            border-radius: 20px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; position: relative;
        }
        .photo-slot:hover { opacity: 0.9; transform: scale(0.99); }
        .photo-slot img { width: 100%; height: 100%; object-fit: cover; }
        .photo-empty { display: flex; flex-direction: column; align-items: center; color: #ccc; gap: 8px; }

        /* --- 6. BOTTOM DOCK (Glass Action Bar) --- */
        .dock-wrapper {
            position: fixed; bottom: 40px; left: 0; right: 0;
            display: flex; justify-content: center; z-index: 50;
            pointer-events: none;
        }

        .dock {
            pointer-events: auto;
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: var(--radius-pill);
            padding: 8px;
            display: flex; align-items: center; gap: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            transform: translateY(0); transition: 0.4s var(--ease-elastic);
        }

        .dock-btn {
            height: 52px; padding: 0 24px; border-radius: var(--radius-pill);
            display: flex; align-items: center; gap: 10px;
            font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
            color: #aaa; background: transparent; border: 1px solid transparent;
            cursor: pointer; transition: 0.2s;
        }
        .dock-btn:hover { color: white; background: rgba(255,255,255,0.05); }
        .dock-btn.active { color: var(--gold-primary); background: rgba(212, 175, 55, 0.1); border-color: rgba(212, 175, 55, 0.2); }

        .dock-btn.primary {
            background: var(--gold-gradient); color: black; border: none;
            box-shadow: var(--gold-glow);
        }
        .dock-btn.primary:hover { transform: scale(1.05); color: black; }

        /* --- 7. BOTTOM SHEET (Drawers) --- */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            z-index: 90; opacity: 0; pointer-events: none; transition: 0.4s;
        }
        .overlay.active { opacity: 1; pointer-events: auto; }

        .sheet-drawer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #121212;
            border-radius: 40px 40px 0 0; /* Super soft top corners */
            border-top: 1px solid #333;
            padding: 32px; padding-bottom: 60px;
            z-index: 100;
            transform: translateY(110%); transition: transform 0.5s var(--ease-elastic);
            max-height: 85vh; overflow-y: auto;
            box-shadow: 0 -20px 80px black;
        }
        .sheet-drawer.open { transform: translateY(0); }

        .drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .drawer-title { font-size: 18px; font-weight: 700; color: white; }

        /* Option Grid */
        .option-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        
        .option-card {
            background: #1a1a1a; border: 1px solid #333; border-radius: 20px;
            padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 12px;
            cursor: pointer; transition: 0.2s;
        }
        .option-card:hover { background: #222; border-color: #666; }
        .option-card.selected { background: rgba(212, 175, 55, 0.1); border-color: var(--gold-primary); }
        
        .option-icon { font-size: 24px; color: #666; }
        .option-card.selected .option-icon { color: var(--gold-primary); }
        .option-label { font-size: 11px; font-weight: 600; color: white; }

        /* Typography Preview Cards */
        .type-card {
            background: white; color: black; border-radius: 16px; padding: 16px; text-align: center;
            border: 2px solid transparent; cursor: pointer; transition: 0.2s;
        }
        .type-card.selected { border-color: var(--gold-primary); box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }

        /* --- 8. PRINT CSS --- */
        @media print {
            body { background: white; height: auto; display: block; overflow: visible; }
            .header-island, .dock-wrapper, .page-badge, .sheet-drawer, .overlay { display: none !important; }
            .workspace { padding: 0; margin: 0; display: block; }
            
            .sheet-card {
                box-shadow: none; border-radius: 0; width: 100%; max-width: 100%;
                break-after: page; page-break-after: always;
                border: none; margin: 0;
            }
            [contenteditable] { border: none !important; }
            @page { size: A5; margin: 0; }
        }

    </style>
</head>
<body>

    <header class="header-island">
        <div>
            <div class="logo-text">FuneralMatch</div>
            <div class="logo-sub">Ethereal Studio</div>
        </div>
        <div class="price-pill" id="total-price">£80.00</div>
    </header>

    <div id="workspace" class="workspace">
        </div>

    <div class="dock-wrapper">
        <div class="dock">
            <button class="dock-btn" onclick="openDrawer('add')">
                <i class="fas fa-plus-circle text-lg"></i> <span class="hidden sm:inline">Add</span>
            </button>
            <button class="dock-btn" onclick="openDrawer('style')">
                <i class="fas fa-swatchbook text-lg"></i> <span class="hidden sm:inline">Style</span>
            </button>
            <div class="w-px h-6 bg-white/10 mx-2"></div>
            <button class="dock-btn primary" onclick="printBooklet()">
                <span>Checkout</span> <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <div id="overlay" class="overlay" onclick="closeDrawers()"></div>

    <div id="drawer-add" class="sheet-drawer">
        <div class="drawer-header">
            <span class="drawer-title">Add Content</span>
            <button onclick="closeDrawers()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20"><i class="fas fa-times"></i></button>
        </div>
        <div class="option-grid">
            <div class="option-card" onclick="addPage('hymn')">
                <i class="fas fa-music option-icon"></i> <span class="option-label">Hymn</span>
            </div>
            <div class="option-card" onclick="addPage('reading')">
                <i class="fas fa-book-open option-icon"></i> <span class="option-label">Reading</span>
            </div>
            <div class="option-card" onclick="addPage('photo')">
                <i class="fas fa-image option-icon"></i> <span class="option-label">Full Photo</span>
            </div>
            <div class="option-card" onclick="addPage('collage')">
                <i class="fas fa-th-large option-icon"></i> <span class="option-label">Collage</span>
            </div>
            <div class="option-card" onclick="addPage('text')">
                <i class="fas fa-align-left option-icon"></i> <span class="option-label">Text Block</span>
            </div>
            <div class="option-card" onclick="addPage('timeline')">
                <i class="fas fa-stream option-icon"></i> <span class="option-label">Timeline</span>
            </div>
        </div>
    </div>

    <div id="drawer-style" class="sheet-drawer">
        <div class="drawer-header">
            <span class="drawer-title">Design Language</span>
            <button onclick="closeDrawers()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20"><i class="fas fa-times"></i></button>
        </div>
        
        <p class="text-xs font-bold text-gray-500 uppercase mb-4 tracking-widest">Typography</p>
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="type-card" onclick="setFont('classic')">
                <span class="font-serif text-3xl block mb-2">Aa</span>
                <span class="text-xs font-bold uppercase tracking-widest">Bodoni</span>
            </div>
            <div class="type-card" onclick="setFont('modern')">
                <span class="font-sans font-bold text-3xl block mb-2">Aa</span>
                <span class="text-xs font-bold uppercase tracking-widest">Modern</span>
            </div>
            <div class="type-card" onclick="setFont('formal')">
                <span style="font-family: 'Cinzel', serif" class="text-3xl block mb-2">Aa</span>
                <span class="text-xs font-bold uppercase tracking-widest">Formal</span>
            </div>
            <div class="type-card" onclick="setFont('soft')">
                <span style="font-family: 'Cormorant Garamond', serif" class="text-3xl italic block mb-2">Aa</span>
                <span class="text-xs font-bold uppercase tracking-widest">Soft</span>
            </div>
        </div>

        <p class="text-xs font-bold text-gray-500 uppercase mb-4 tracking-widest">Paper Stock</p>
        <div class="flex gap-4">
            <div onclick="setPaper('cream')" class="w-14 h-14 rounded-full bg-[#fdfbf7] border-2 border-transparent cursor-pointer hover:border-[#D4AF37]"></div>
            <div onclick="setPaper('stone')" class="w-14 h-14 rounded-full bg-[#e5e5e5] border-2 border-transparent cursor-pointer hover:border-[#D4AF37]"></div>
            <div onclick="setPaper('white')" class="w-14 h-14 rounded-full bg-white border-2 border-transparent cursor-pointer hover:border-[#D4AF37]"></div>
        </div>
    </div>

    <input type="file" id="img-upload" class="hidden" accept="image/*">

    <script>
        // === 1. DATA ===
        const state = {
            pages: [],
            settings: { font: 'classic', paper: 'cream' }
        };

        const TEMPLATES = {
            cover: `
                <div class="content-wrap items-center justify-center text-center">
                    <div class="mb-8 text-xs uppercase tracking-[0.2em] text-gray-500 font-bold" contenteditable="true">In Loving Memory</div>
                    <div class="photo-slot rounded-full w-48 h-48 mb-8 shadow-xl border-[6px] border-double border-gray-100" onclick="upload(this)">
                        <div class="photo-empty"><i class="fas fa-camera text-2xl opacity-20"></i></div>
                    </div>
                    <div class="text-5xl mb-4 font-bold leading-none" contenteditable="true">Name<br>Here</div>
                    <div class="text-sm opacity-60 italic mb-12" contenteditable="true">1950 — 2026</div>
                    <div class="mt-auto text-[10px] uppercase font-bold opacity-40 tracking-widest" contenteditable="true">St Mary's Church</div>
                </div>`,
            
            text: `
                <div class="content-wrap">
                    <div class="text-lg font-bold mb-6 border-b border-black/10 pb-4 text-[#D4AF37]" contenteditable="true">Reading</div>
                    <div class="text-sm leading-loose opacity-80 whitespace-pre-wrap" contenteditable="true">
Tap here to edit text. 
Share a poem, a eulogy, or a favorite memory.
                    </div>
                </div>`,
            
            photo: `
                <div class="content-wrap p-0">
                    <div class="photo-slot w-full h-[65%] bg-gray-100 rounded-none" onclick="upload(this)">
                        <div class="photo-empty"><i class="fas fa-image text-3xl mb-2"></i><span class="text-xs font-bold uppercase tracking-widest opacity-50">Add Photo</span></div>
                    </div>
                    <div class="p-10 text-center">
                        <div class="text-xl font-bold mb-2" contenteditable="true">Caption Title</div>
                        <div class="text-xs opacity-60" contenteditable="true">Add a description of this moment...</div>
                    </div>
                </div>`,
            
            hymn: `
                <div class="content-wrap items-center pt-16 text-center px-8">
                    <div class="text-[10px] uppercase font-bold text-gray-300 mb-6 tracking-[0.2em]" contenteditable="true">Hymn</div>
                    <div class="text-3xl italic mb-8 font-bold text-gray-800" contenteditable="true">Abide With Me</div>
                    <div class="text-sm italic opacity-60 leading-loose" contenteditable="true">
Abide with me;<br>fast falls the eventide;<br>The darkness deepens;<br>Lord with me abide.<br>When other helpers fail<br>and comforts flee,<br>Help of the helpless,<br>O abide with me.
                    </div>
                </div>`
        };

        // === 2. INIT ===
        function init() {
            // Load Saved or Default
            const saved = localStorage.getItem('ethereal_v1');
            if(saved) {
                const data = JSON.parse(saved);
                state.pages = data.pages;
                state.settings = data.settings;
            } else {
                addPage('cover', false);
                addPage('text', false);
                addPage('hymn', false);
                addPage('text', false); // Back cover
            }
            render();
            updatePrice();
        }

        // === 3. RENDER ENGINE ===
        function render() {
            const workspace = document.getElementById('workspace');
            workspace.innerHTML = '';

            state.pages.forEach((page, index) => {
                const sheet = document.createElement('div');
                // Apply Design System Classes
                let fontClass = state.settings.font === 'classic' ? 'font-serif' : 
                                state.settings.font === 'modern' ? 'font-sans' : 
                                state.settings.font === 'formal' ? 'font-[Cinzel]' : 'italic';
                
                let paperColor = state.settings.paper === 'cream' ? '#fdfbf7' : 
                                 state.settings.paper === 'stone' ? '#e5e5e5' : '#ffffff';

                sheet.className = `sheet-card ${fontClass}`;
                sheet.style.backgroundColor = paperColor;
                sheet.id = `page-${index}`;

                // Inject Content
                sheet.innerHTML = `
                    <div class="page-badge">Page ${index + 1}</div>
                    <div class="sheet-content h-full flex flex-col">${page.html}</div>
                    ${state.pages.length > 4 ? `<button onclick="deletePage(${index})" class="absolute top-4 left-4 w-8 h-8 rounded-full bg-red-50 text-red-400 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity"><i class="fas fa-trash text-xs"></i></button>` : ''}
                `;

                // Logic: Focus/Save
                sheet.addEventListener('click', () => {
                    document.querySelectorAll('.sheet-card').forEach(c => c.classList.remove('active'));
                    sheet.classList.add('active');
                });

                sheet.addEventListener('input', () => {
                    state.pages[index].html = sheet.querySelector('.sheet-content').innerHTML;
                    saveState();
                });

                workspace.appendChild(sheet);
            });
        }

        // === 4. ACTIONS ===
        function addPage(type, save=true) {
            let html = TEMPLATES[type] || TEMPLATES.text;
            state.pages.push({ id: Date.now(), html: html });
            if(save) {
                render();
                saveState();
                closeDrawers();
                updatePrice();
                // Scroll to bottom smoothly
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
        }

        function deletePage(index) {
            if(confirm("Remove this page?")) {
                state.pages.splice(index, 1);
                render();
                saveState();
                updatePrice();
            }
        }

        // === 5. STYLING SYSTEM ===
        function setFont(font) {
            state.settings.font = font;
            // Update CSS mapping for render
            const fontMap = {
                'classic': "'Bodoni Moda', serif",
                'modern': "'Inter', sans-serif",
                'formal': "'Cinzel', serif",
                'soft': "'Cormorant Garamond', serif"
            };
            document.documentElement.style.setProperty('--font-current', fontMap[font]);
            render(); // Re-render to apply classes
            saveState();
            closeDrawers();
        }

        function setPaper(color) {
            state.settings.paper = color;
            render();
            saveState();
            closeDrawers();
        }

        // === 6. PHOTO HANDLING ===
        let uploadTarget = null;
        function upload(el) {
            uploadTarget = el;
            document.getElementById('img-upload').click();
        }
        document.getElementById('img-upload').onchange = (e) => {
            if(e.target.files[0] && uploadTarget) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    uploadTarget.innerHTML = `<img src="${evt.target.result}">`;
                    uploadTarget.style.background = 'transparent';
                    // Trigger Input Event for Save
                    const pageIndex = uploadTarget.closest('.sheet-card').id.split('-')[1];
                    state.pages[pageIndex].html = document.getElementById(`page-${pageIndex}`).querySelector('.sheet-content').innerHTML;
                    saveState();
                    updatePrice();
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        };

        // === 7. UI UTILITIES ===
        function openDrawer(id) {
            closeDrawers();
            document.getElementById('overlay').classList.add('active');
            document.getElementById(`drawer-${id}`).classList.add('open');
        }

        function closeDrawers() {
            document.getElementById('overlay').classList.remove('active');
            document.querySelectorAll('.sheet-drawer').forEach(d => d.classList.remove('open'));
        }

        function saveState() {
            localStorage.setItem('ethereal_v1', JSON.stringify(state));
        }

        function updatePrice() {
            // Count photos
            let photos = 0;
            state.pages.forEach(p => photos += (p.html.match(/<img/g) || []).length);
            
            let price = 80;
            if(state.pages.length > 4) price += (state.pages.length - 4) * 10;
            if(photos > 5) price += (photos - 5) * 7.50;

            const pill = document.getElementById('total-price');
            pill.innerText = `£${price.toFixed(2)}`;
            pill.classList.add('updated');
            setTimeout(() => pill.classList.remove('updated'), 300);
        }

        function printBooklet() {
            window.print();
        }

        // Typography CSS Mapping Helper (Dynamic Injection)
        const style = document.createElement('style');
        style.innerHTML = `
            .font-serif { font-family: 'Bodoni Moda', serif; }
            .font-sans { font-family: 'Inter', sans-serif; font-weight: 600; text-transform: uppercase; }
            .font-formal { font-family: 'Cinzel', serif; }
            .font-soft { font-family: 'Cormorant Garamond', serif; font-style: italic; }
        `;
        document.head.appendChild(style);

        // Start
        init();

    </script>
</body>
</html>
