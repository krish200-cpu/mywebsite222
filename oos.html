<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Booklet Designer | FuneralMatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,700;1,400&family=Cinzel:wght@400;700&family=Great+Vibes&family=Inter:wght@300;400;600&family=Lato:wght@300;400;700&family=Lora:ital,wght@0,400;1,400&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- CORE VARIABLES --- */
        :root { --gold: #C5A059; --dark: #121212; --panel-bg: #1E1E1E; --border: rgba(255,255,255,0.1); }
        body { font-family: 'Inter', sans-serif; background: var(--dark); color: white; height: 100vh; overflow: hidden; }

        /* --- UI COMPONENTS --- */
        /* Custom Scrollbar for the editor panel */
        .editor-scroll::-webkit-scrollbar { width: 6px; }
        .editor-scroll::-webkit-scrollbar-track { background: var(--dark); }
        .editor-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .editor-scroll::-webkit-scrollbar-thumb:hover { background: var(--gold); }

        .control-group { margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 2rem; }
        .control-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: #888; margin-bottom: 0.5rem; display: block; }
        
        .input-std { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 12px; border-radius: 8px; color: white; font-size: 0.9rem; transition: 0.2s; }
        .input-std:focus { border-color: var(--gold); outline: none; background: rgba(255,255,255,0.1); }
        textarea.input-std { min-height: 100px; resize: vertical; }

        /* --- PAGE NAVIGATION (The "Timeline") --- */
        .page-nav { display: flex; gap: 8px; overflow-x: auto; padding: 4px; scroll-behavior: smooth; }
        .page-node { min-width: 40px; height: 40px; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; cursor: pointer; border: 1px solid transparent; transition: 0.2s; color: #aaa; }
        .page-node:hover { background: #444; color: white; }
        .page-node.active { background: var(--gold); color: black; border-color: var(--gold); transform: scale(1.1); box-shadow: 0 0 15px rgba(197,160,89,0.3); }

        /* --- LAYOUT SELECTOR CARDS --- */
        .layout-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .layout-card { border: 1px solid var(--border); border-radius: 8px; padding: 10px; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.02); text-align: center; }
        .layout-card:hover { border-color: #666; }
        .layout-card.selected { border-color: var(--gold); background: rgba(197, 160, 89, 0.1); }
        .layout-icon { font-size: 1.5rem; margin-bottom: 5px; color: #666; }
        .layout-card.selected .layout-icon { color: var(--gold); }
        .layout-name { font-size: 0.65rem; text-transform: uppercase; font-weight: 700; }

        /* --- PREVIEW AREA --- */
        /* A4 Aspect Ratio Container */
        .a4-container { 
            aspect-ratio: 1 / 1.414; 
            background: white; 
            width: 100%; 
            max-width: 450px; 
            margin: 0 auto; 
            position: relative; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
            transition: transform 0.3s ease;
            color: black;
            overflow: hidden;
        }
        
        /* Font Stacks */
        .font-traditional h1, .font-traditional h2 { font-family: 'Cinzel', serif; }
        .font-traditional p { font-family: 'Lora', serif; }

        .font-modern h1, .font-modern h2 { font-family: 'Montserrat', sans-serif; letter-spacing: 0.1em; text-transform: uppercase; }
        .font-modern p { font-family: 'Lato', sans-serif; }

        .font-elegant h1, .font-elegant h2 { font-family: 'Great Vibes', cursive; }
        .font-elegant p { font-family: 'Bodoni Moda', serif; }

        /* Helpers for content placement */
        .page-content { height: 100%; display: flex; flex-direction: column; }
        .photo-placeholder { background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #ccc; width: 100%; overflow: hidden; }
        .photo-placeholder img { width: 100%; height: 100%; object-fit: cover; }

    </style>
</head>
<body class="flex flex-col lg:flex-row">

    <div class="w-full lg:w-[450px] bg-panel-bg border-r border-white/10 flex flex-col h-screen z-20 shadow-2xl">
        
        <div class="p-6 border-b border-white/10 bg-dark/50 backdrop-blur-md sticky top-0 z-30">
            <div class="flex items-center gap-3 mb-1">
                <i class="fas fa-book-open text-[#C5A059]"></i>
                <h2 class="text-sm font-bold uppercase tracking-widest text-white">Booklet Architect</h2>
            </div>
            <p class="text-xs text-gray-500">Pro Edition v2.0</p>
        </div>

        <div class="flex-1 overflow-y-auto editor-scroll p-6">
            
            <div class="control-group">
                <label class="control-label text-[#C5A059]"><i class="fas fa-layer-group mr-2"></i> Document Structure</label>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="text-[10px] text-gray-400 uppercase font-bold mb-2 block">Total Pages</label>
                        <select id="pageCountSelect" onchange="changePageCount(this.value)" class="input-std cursor-pointer">
                            <option value="4">4 Pages (Standard)</option>
                            <option value="8">8 Pages (+£40)</option>
                            <option value="12">12 Pages (+£80)</option>
                            <option value="16">16 Pages (Max)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 uppercase font-bold mb-2 block">Typography</label>
                        <select id="fontSelect" onchange="changeFontTheme(this.value)" class="input-std cursor-pointer">
                            <option value="traditional">Traditional (Cinzel)</option>
                            <option value="modern">Modern (Clean)</option>
                            <option value="elegant">Elegant (Script)</option>
                        </select>
                    </div>
                </div>
                
                <label class="text-[10px] text-gray-400 uppercase font-bold mb-2 block">Jump to Page</label>
                <div class="page-nav no-scrollbar" id="pageNavContainer">
                    </div>
            </div>

            <div id="dynamicEditorArea" class="animate-fade-in">
                
                <div class="flex justify-between items-center mb-4">
                    <label class="control-label text-white text-lg"><span id="editorPageLabel">Cover Page</span> Design</label>
                    <span class="text-[10px] bg-white/10 px-2 py-1 rounded text-gray-400">Editing Page <span id="currentPageNum">1</span></span>
                </div>

                <div class="mb-6">
                    <label class="control-label">Select Layout Template</label>
                    <div class="layout-grid" id="layoutGrid">
                        </div>
                </div>

                <div id="inputContainer" class="space-y-4">
                    </div>

            </div>

        </div>

        <div class="p-6 border-t border-white/10 bg-[#151515] sticky bottom-0 z-30">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <p class="text-[10px] uppercase font-bold text-gray-500 mb-1">Total Photos: <span id="photoCountDisplay" class="text-white">0</span>/5</p>
                    <p id="photoSurchargeMsg" class="text-[10px] text-red-400 hidden">+£7.50 per extra photo</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] uppercase font-bold text-gray-500">Est. Total</p>
                    <p id="totalPriceDisplay" class="text-2xl font-bold text-[#C5A059]">£80.00</p>
                </div>
            </div>
            <button class="w-full bg-[#C5A059] hover:bg-white hover:text-black text-black font-bold py-3 rounded-lg uppercase tracking-widest text-xs transition-all flex justify-between px-6">
                <span>Save Design</span>
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

    </div>

    <div class="flex-1 bg-black relative flex flex-col h-screen overflow-hidden">
        
        <div class="h-16 border-b border-white/10 flex items-center justify-between px-8 bg-dark/50">
            <div class="flex gap-4">
                <button class="text-xs text-gray-400 hover:text-white uppercase font-bold tracking-wider" onclick="prevPage()"><i class="fas fa-arrow-left mr-2"></i> Prev Page</button>
            </div>
            <span class="text-xs font-bold text-[#C5A059] uppercase tracking-widest">Live Preview</span>
            <div class="flex gap-4">
                <button class="text-xs text-gray-400 hover:text-white uppercase font-bold tracking-wider" onclick="nextPage()">Next Page <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div>

        <div class="flex-1 bg-[#0a0a0a] flex items-center justify-center p-8 overflow-y-auto">
            
            <div id="previewContainer" class="a4-container font-traditional p-8 sm:p-12 relative">
                <div class="absolute inset-0 pointer-events-none opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png'); mix-blend-mode: multiply;"></div>
                
                <div id="previewContent" class="page-content relative z-10">
                    </div>
            </div>

        </div>
        
    </div>

    <script>
        // ===========================
        // 1. DATA STATE
        // ===========================
        const state = {
            totalPages: 4,
            currentPage: 1, // 1-based index
            fontTheme: 'traditional',
            basePrice: 80, // for 20 copies base
            extraPhotoPrice: 7.50,
            pages: [] // Array to hold data for each page
        };

        // Layout Templates Definition
        const LAYOUTS = {
            COVER: [
                { id: 'cover-classic', name: 'Classic Text', icon: 'fas fa-align-center' },
                { id: 'cover-photo', name: 'Large Photo', icon: 'fas fa-image' }
            ],
            INNER: [
                { id: 'text-full', name: 'Full Text', icon: 'fas fa-align-left' },
                { id: 'hymn-list', name: 'Hymn / Song', icon: 'fas fa-music' },
                { id: 'photo-top', name: 'Photo Top', icon: 'fas fa-portrait' },
                { id: 'photo-full', name: 'Full Page Photo', icon: 'fas fa-expand' }
            ]
        };

        // Initialize State
        function init() {
            // Create initial empty pages
            for(let i=1; i<=16; i++) {
                state.pages[i] = {
                    type: i===1 ? 'cover' : 'inner',
                    layout: i===1 ? 'cover-classic' : 'text-full',
                    title: i===1 ? 'In Loving Memory' : `Page ${i} Title`,
                    body: i===1 ? 'Name of Deceased' : 'Enter text here...',
                    photo: null,
                    hymnLines: ['Verse 1...', 'Verse 2...']
                };
            }
            renderNav();
            loadEditorForPage(1);
            updatePricing();
        }

        // ===========================
        // 2. NAVIGATION LOGIC
        // ===========================
        function changePageCount(val) {
            state.totalPages = parseInt(val);
            // Cap current page if we shrank the document
            if (state.currentPage > state.totalPages) {
                state.currentPage = state.totalPages;
            }
            renderNav();
            updatePricing();
            loadEditorForPage(state.currentPage);
        }

        function renderNav() {
            const container = document.getElementById('pageNavContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= state.totalPages; i++) {
                const node = document.createElement('div');
                node.className = `page-node ${i === state.currentPage ? 'active' : ''}`;
                node.innerText = i;
                node.onclick = () => loadEditorForPage(i);
                container.appendChild(node);
            }
        }

        function nextPage() {
            if(state.currentPage < state.totalPages) loadEditorForPage(state.currentPage + 1);
        }
        function prevPage() {
            if(state.currentPage > 1) loadEditorForPage(state.currentPage - 1);
        }

        // ===========================
        // 3. EDITOR RENDERER
        // ===========================
        function loadEditorForPage(pageNum) {
            state.currentPage = pageNum;
            const pageData = state.pages[pageNum];
            
            // Update UI Labels
            document.getElementById('currentPageNum').innerText = pageNum;
            document.getElementById('editorPageLabel').innerText = pageNum === 1 ? 'Cover' : `Page ${pageNum}`;
            renderNav(); // Update active class

            // 1. Render Layout Grid
            const grid = document.getElementById('layoutGrid');
            grid.innerHTML = '';
            const availableLayouts = pageNum === 1 ? LAYOUTS.COVER : LAYOUTS.INNER;
            
            availableLayouts.forEach(layout => {
                const card = document.createElement('div');
                card.className = `layout-card ${pageData.layout === layout.id ? 'selected' : ''}`;
                card.onclick = () => changeLayout(layout.id);
                card.innerHTML = `<i class="${layout.icon} layout-icon"></i><div class="layout-name">${layout.name}</div>`;
                grid.appendChild(card);
            });

            // 2. Render Inputs based on current Layout
            renderInputs(pageData.layout);
            
            // 3. Render Preview
            renderPreview();
        }

        function changeLayout(layoutId) {
            state.pages[state.currentPage].layout = layoutId;
            loadEditorForPage(state.currentPage); // Re-render everything
        }

        function renderInputs(layoutId) {
            const container = document.getElementById('inputContainer');
            container.innerHTML = '';
            const page = state.pages[state.currentPage];

            // Helper to create input
            const createInput = (label, key, type='text', placeholder='') => {
                const div = document.createElement('div');
                div.innerHTML = `<label class="control-label">${label}</label>`;
                
                let input;
                if(type === 'textarea') {
                    input = document.createElement('textarea');
                    input.className = 'input-std';
                    input.value = page[key];
                    input.oninput = (e) => { page[key] = e.target.value; renderPreview(); };
                } else if (type === 'file') {
                    input = document.createElement('div');
                    input.className = 'border border-dashed border-gray-600 rounded p-4 text-center cursor-pointer hover:border-gold hover:bg-white/5';
                    input.innerHTML = `<i class="fas fa-camera text-2xl mb-2 text-gray-500"></i><p class="text-xs text-gray-400">${page.photo ? 'Change Photo' : 'Upload Photo'}</p>`;
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'file';
                    hiddenInput.accept = 'image/*';
                    hiddenInput.style.display = 'none';
                    hiddenInput.onchange = (e) => handlePhotoUpload(e);
                    input.onclick = () => hiddenInput.click();
                    input.appendChild(hiddenInput);
                } else {
                    input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'input-std';
                    input.value = page[key];
                    input.placeholder = placeholder;
                    input.oninput = (e) => { page[key] = e.target.value; renderPreview(); };
                }
                div.appendChild(input);
                container.appendChild(div);
            };

            // Logic for what inputs to show
            if (layoutId.includes('text') || layoutId.includes('classic')) {
                createInput('Main Heading / Name', 'title');
                createInput('Body Text / Details', 'body', 'textarea');
            }
            else if (layoutId.includes('photo')) {
                createInput('Heading', 'title');
                createInput('Upload Image', 'photo', 'file');
                if(!layoutId.includes('full')) createInput('Caption / Text', 'body', 'textarea');
            }
            else if (layoutId.includes('hymn')) {
                createInput('Hymn Title', 'title');
                createInput('Lyrics (Paste here)', 'body', 'textarea');
            }
        }

        // ===========================
        // 4. PREVIEW RENDERER
        // ===========================
        function changeFontTheme(theme) {
            state.fontTheme = theme;
            const container = document.getElementById('previewContainer');
            // Remove old font classes
            container.classList.remove('font-traditional', 'font-modern', 'font-elegant');
            container.classList.add(`font-${theme}`);
        }

        function renderPreview() {
            const container = document.getElementById('previewContent');
            const page = state.pages[state.currentPage];
            
            let html = '';

            // Layout: Cover Classic
            if (page.layout === 'cover-classic') {
                html = `
                    <div class="h-full flex flex-col justify-between text-center py-10 border-4 border-double border-gray-200 m-2">
                        <div class="mt-8">
                            <p class="text-sm uppercase tracking-[0.2em] text-gray-500 mb-4">In Loving Memory of</p>
                            <h1 class="text-4xl md:text-5xl leading-tight text-gray-800">${page.title}</h1>
                        </div>
                        <div class="mb-12">
                            <div class="w-16 h-px bg-black mx-auto mb-4"></div>
                            <p class="text-sm whitespace-pre-wrap">${page.body}</p>
                        </div>
                    </div>
                `;
            }
            // Layout: Photo Top
            else if (page.layout === 'photo-top' || page.layout === 'cover-photo') {
                html = `
                    <div class="h-full flex flex-col text-center">
                        <div class="h-1/2 w-full photo-placeholder mb-6 relative">
                            ${page.photo ? `<img src="${page.photo}">` : '<i class="fas fa-user text-4xl"></i>'}
                            ${state.currentPage === 1 ? '<div class="absolute inset-0 border-b-4 border-gold opacity-50"></div>' : ''}
                        </div>
                        <div class="px-8">
                            <h2 class="text-2xl mb-4 text-gray-800">${page.title}</h2>
                            <p class="text-sm text-gray-600 whitespace-pre-wrap leading-relaxed">${page.body}</p>
                        </div>
                    </div>
                `;
            }
            // Layout: Full Text
            else if (page.layout === 'text-full') {
                html = `
                    <div class="h-full px-8 py-12">
                        <h2 class="text-xl font-bold mb-6 text-gray-800 border-b border-gray-200 pb-2">${page.title}</h2>
                        <p class="text-sm text-gray-600 whitespace-pre-wrap leading-loose text-justify">${page.body}</p>
                    </div>
                `;
            }
            // Layout: Full Photo
            else if (page.layout === 'photo-full') {
                html = `
                    <div class="h-full w-full photo-placeholder relative">
                         ${page.photo ? `<img src="${page.photo}">` : '<div class="text-center"><i class="fas fa-image text-4xl mb-2"></i><p>Full Page Photo</p></div>'}
                         <div class="absolute bottom-10 left-0 right-0 text-center">
                            <h2 class="text-white text-3xl drop-shadow-md">${page.title}</h2>
                         </div>
                    </div>
                `;
            }
            // Layout: Hymn
            else if (page.layout === 'hymn-list') {
                html = `
                    <div class="h-full px-8 py-12 text-center">
                        <p class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-2">Hymn</p>
                        <h2 class="text-2xl mb-8 text-gray-800 italic">${page.title}</h2>
                        <div class="text-sm text-gray-600 whitespace-pre-wrap leading-loose font-serif italic">
                            ${page.body}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // ===========================
        // 5. SMART LOGIC: PHOTOS & PRICING
        // ===========================
        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    state.pages[state.currentPage].photo = evt.target.result;
                    renderPreview();
                    updatePricing(); // Re-calc photo count
                };
                reader.readAsDataURL(file);
            }
        }

        function updatePricing() {
            // 1. Calculate Page Count Cost
            let pageCost = 0;
            if (state.totalPages === 8) pageCost = 40;
            if (state.totalPages === 12) pageCost = 80;
            if (state.totalPages === 16) pageCost = 120;

            // 2. Count Photos across ALL pages
            let photoCount = 0;
            for(let i=1; i<=16; i++) {
                if (state.pages[i].photo) photoCount++;
            }

            // 3. Calculate Surcharge
            let photoSurcharge = 0;
            if (photoCount > 5) {
                photoSurcharge = (photoCount - 5) * state.extraPhotoPrice;
                document.getElementById('photoSurchargeMsg').classList.remove('hidden');
            } else {
                document.getElementById('photoSurchargeMsg').classList.add('hidden');
            }

            // Update UI
            document.getElementById('photoCountDisplay').innerText = photoCount;
            const finalPrice = state.basePrice + pageCost + photoSurcharge;
            
            document.getElementById('totalPriceDisplay').innerText = '£' + finalPrice.toFixed(2);
        }

        // Boot
        window.onload = init;

    </script>
</body>
</html>
